var p=(D,k,i)=>new Promise((d,h)=>{var S=x=>{try{v(i.next(x))}catch(_){h(_)}},C=x=>{try{v(i.throw(x))}catch(_){h(_)}},v=x=>x.done?d(x.value):Promise.resolve(x.value).then(S,C);v((i=i.apply(D,k)).next())});import{B as H,r as w,o as J,z as K,c as N,a as O,q as m,b as c,h as u,u as a,l as o,I as r,i as t,t as l,n as Q,F as $,C as L}from"./vue-vendor-Cs4IDGu-.js";import{A as W}from"./AppLayout-jrBjamem.js";import{B as g}from"./BaseCard-Co3fH4X5.js";import{_ as X}from"./ExecutionStatusBadge-BtYUDsGU.js";import{u as Y,_ as Z}from"./useSchedules-DSD01Jii.js";import{u as tt}from"./useFlows-D_qEO5GI.js";import"./useAuth-C1_85XZE.js";import"./utils-nSMfNdYQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const et={key:0,class:"flex justify-center items-center h-64"},st={key:1},nt={class:"flex items-center justify-between mb-6"},at={class:"text-2xl font-bold text-gray-900"},ot={class:"text-gray-600 mt-1"},lt={class:"flex items-center space-x-3"},it=["disabled"],ct={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ut={class:"space-y-3"},dt={class:"flex justify-between"},rt={class:"font-medium"},xt={class:"flex justify-between"},ft={class:"font-medium"},pt={class:"space-y-3"},mt={class:"flex justify-between"},yt={class:"font-medium"},gt={class:"flex justify-between"},vt={class:"font-medium"},_t={class:"flex justify-between"},bt={class:"font-medium text-sm"},ht={class:"space-y-3"},wt={class:"flex justify-between"},kt={class:"font-medium text-sm"},St={class:"flex justify-between"},Ct={class:"font-medium text-sm"},Et={class:"flex justify-between"},Ft={class:"font-medium"},jt={key:0,class:"space-y-3"},Dt={class:"flex items-center space-x-3"},At={class:"font-medium text-gray-900"},Bt={class:"text-sm text-gray-600"},Rt={key:1,class:"text-center py-8"},Nt={key:0,class:"space-y-3"},$t=["onClick"],Lt={class:"flex items-center space-x-3"},Vt={class:"text-sm text-gray-600"},Tt={class:"text-xs text-gray-500"},It={key:1,class:"text-center py-8"},Ut={class:"bg-gray-50 border border-gray-200 rounded-lg h-64 flex items-center justify-center"},Pt={class:"text-center"},zt={class:"text-sm text-gray-400 mt-1"},qt={key:2,class:"text-center py-8"},te={__name:"FlowDetailView",setup(D){const k=H(),i=K(),{currentFlow:d,loading:h,getFlow:S,executeFlow:C,getFlowStats:v,getExecutions:x}=tt(),{getSchedules:_}=Y(),f=k.params.id,b=w({}),y=w(!1),E=w([]),F=w([]);J(()=>p(null,null,function*(){yield V(),yield T(),yield I(),yield U()}));function V(){return p(this,null,function*(){(yield S(f)).success||i.push("/dashboard")})}function T(){return p(this,null,function*(){const s=yield v(f);s.success&&(b.value=s.data)})}function I(){return p(this,null,function*(){const s=yield x({flowId:f,limit:5,page:1});s.success&&(E.value=s.data||[])})}function U(){return p(this,null,function*(){const s=yield _({flowId:f,enabled:!0});s.success&&(F.value=s.data||[])})}const A=N(()=>{var s,e,n;return((n=(e=(s=d.value)==null?void 0:s.flowData)==null?void 0:e.nodes)==null?void 0:n.length)||0}),B=N(()=>{var s,e,n;return((n=(e=(s=d.value)==null?void 0:s.flowData)==null?void 0:e.edges)==null?void 0:n.length)||0});function P(){i.push(`/flows/${f}/edit`)}function z(){return p(this,null,function*(){y.value=!0;const s=yield C(f);y.value=!1,s.success&&i.push(`/executions/${s.data.id}`)})}function j(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function R(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function q(){i.push("/schedules")}function M(){i.push(`/executions?flowId=${f}`)}function G(s){i.push(`/executions/${s}`)}return(s,e)=>(c(),O(W,null,{default:m(()=>[a(h)?(c(),u("div",et,[o(a(r),{icon:"lucide:loader-2",class:"w-8 h-8 animate-spin text-gray-400"})])):a(d)?(c(),u("div",st,[t("div",nt,[t("div",null,[t("h1",at,l(a(d).name),1),t("p",ot,l(a(d).description||"No description"),1)]),t("div",lt,[t("button",{onClick:z,disabled:y.value,class:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2"},[o(a(r),{icon:y.value?"lucide:loader-2":"lucide:play",class:Q(["w-4 h-4",{"animate-spin":y.value}])},null,8,["icon","class"]),t("span",null,l(y.value?"Executing...":"Execute"),1)],8,it),t("button",{onClick:P,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2"},[o(a(r),{icon:"lucide:edit",class:"w-4 h-4"}),e[1]||(e[1]=t("span",null,"Edit",-1))])])]),t("div",ct,[o(g,{title:"Flow Structure"},{default:m(()=>[t("div",ut,[t("div",dt,[e[2]||(e[2]=t("span",{class:"text-gray-600"},"Nodes:",-1)),t("span",rt,l(A.value),1)]),t("div",xt,[e[3]||(e[3]=t("span",{class:"text-gray-600"},"Connections:",-1)),t("span",ft,l(B.value),1)]),e[4]||(e[4]=t("div",{class:"flex justify-between"},[t("span",{class:"text-gray-600"},"Status:"),t("span",{class:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs"},"Active")],-1))])]),_:1}),o(g,{title:"Execution Stats"},{default:m(()=>[t("div",pt,[t("div",mt,[e[5]||(e[5]=t("span",{class:"text-gray-600"},"Total Runs:",-1)),t("span",yt,l(b.value.totalExecutions||0),1)]),t("div",gt,[e[6]||(e[6]=t("span",{class:"text-gray-600"},"Success Rate:",-1)),t("span",vt,l(b.value.successRate||0)+"%",1)]),t("div",_t,[e[7]||(e[7]=t("span",{class:"text-gray-600"},"Last Run:",-1)),t("span",bt,l(b.value.lastExecution?j(b.value.lastExecution):"Never"),1)])])]),_:1}),o(g,{title:"Flow Details"},{default:m(()=>[t("div",ht,[t("div",wt,[e[8]||(e[8]=t("span",{class:"text-gray-600"},"Created:",-1)),t("span",kt,l(j(a(d).createdAt)),1)]),t("div",St,[e[9]||(e[9]=t("span",{class:"text-gray-600"},"Updated:",-1)),t("span",Ct,l(j(a(d).updatedAt)),1)]),t("div",Et,[e[10]||(e[10]=t("span",{class:"text-gray-600"},"Visibility:",-1)),t("span",Ft,l(a(d).isPublic?"Public":"Private"),1)])])]),_:1})]),o(g,{title:"Active Schedules",subtitle:"Automated execution schedules for this flow",class:"mb-8"},{default:m(()=>[F.value.length>0?(c(),u("div",jt,[(c(!0),u($,null,L(F.value,n=>(c(),u("div",{key:n._id,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[t("div",Dt,[o(a(r),{icon:"lucide:clock",class:"w-5 h-5 text-gray-400"}),t("div",null,[t("div",At,l(n.scheduleType.charAt(0).toUpperCase()+n.scheduleType.slice(1))+" Schedule ",1),t("div",Bt," Next run: "+l(R(n.nextExecutionAt)),1)])]),o(Z,{enabled:n.enabled,"is-currently-running":n.isCurrentlyRunning},null,8,["enabled","is-currently-running"])]))),128))])):(c(),u("div",Rt,[o(a(r),{icon:"lucide:calendar-off",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e[12]||(e[12]=t("p",{class:"text-gray-500 mb-4"},"No active schedules for this flow",-1)),t("button",{onClick:q,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 inline-flex items-center space-x-2"},[o(a(r),{icon:"lucide:plus",class:"w-4 h-4"}),e[11]||(e[11]=t("span",null,"Create Schedule",-1))])]))]),_:1}),o(g,{title:"Recent Executions",subtitle:"Latest execution history",class:"mb-8"},{default:m(()=>[E.value.length>0?(c(),u("div",Nt,[(c(!0),u($,null,L(E.value,n=>(c(),u("div",{key:n._id,onClick:Mt=>G(n._id),class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors"},[t("div",Lt,[o(a(r),{icon:"lucide:play-circle",class:"w-5 h-5 text-gray-400"}),t("div",null,[t("div",Vt,l(R(n.startedAt)),1),t("div",Tt," Triggered by: "+l(n.triggeredBy),1)])]),o(X,{status:n.status},null,8,["status"])],8,$t))),128)),t("button",{onClick:M,class:"w-full text-center text-sm text-blue-600 hover:text-blue-700 py-2"}," View all executions â†’ ")])):(c(),u("div",It,[o(a(r),{icon:"lucide:inbox",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e[13]||(e[13]=t("p",{class:"text-gray-500"},"No executions yet",-1))]))]),_:1}),o(g,{title:"Flow Diagram",subtitle:"Visual representation of your workflow"},{default:m(()=>[t("div",Ut,[t("div",Pt,[o(a(r),{icon:"lucide:workflow",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[14]||(e[14]=t("p",{class:"text-gray-500"},"Flow diagram preview",-1)),t("p",zt,l(A.value)+" nodes, "+l(B.value)+" connections",1)])])]),_:1})])):(c(),u("div",qt,[o(a(r),{icon:"lucide:alert-circle",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[15]||(e[15]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Flow not found",-1)),e[16]||(e[16]=t("p",{class:"text-gray-600 mb-4"},"The flow you're looking for doesn't exist or has been deleted.",-1)),t("button",{onClick:e[0]||(e[0]=n=>a(i).push("/dashboard")),class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"}," Back to Dashboard ")]))]),_:1}))}};export{te as default};
