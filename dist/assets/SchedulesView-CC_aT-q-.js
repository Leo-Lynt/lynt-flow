var W=(I,G,D)=>new Promise((L,g)=>{var O=$=>{try{c(D.next($))}catch(U){g(U)}},l=$=>{try{c(D.throw($))}catch(U){g(U)}},c=$=>$.done?L($.value):Promise.resolve($.value).then(O,l);c((D=D.apply(I,G)).next())});import{r as E,c as j,h as n,b as a,i as e,k as v,F as k,C as _,n as f,a as re,u as b,I as p,t as d,l as x,p as y,v as T,G as B,m as ee,y as Z,x as xe,E as pe,o as ge,J as fe,w as ye,q as we,z as he}from"./vue-vendor-Cs4IDGu-.js";import{A as ke}from"./AppLayout-jrBjamem.js";import{u as ce,_ as _e}from"./useSchedules-DSD01Jii.js";import{u as $e}from"./useFlows-D_qEO5GI.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-C1_85XZE.js";import"./utils-nSMfNdYQ.js";const Ee={class:"space-y-6"},Ce={class:"flex items-center justify-between mb-8"},Se={key:1},Me={key:0,class:"space-y-4"},Ve={class:"grid grid-cols-1 gap-3"},Te=["onClick"],Ie={class:"flex items-center justify-between"},Oe={class:"font-medium text-gray-900"},Ue={class:"text-sm text-gray-600 mt-1"},Ae={key:0,class:"text-brand-red text-sm tracking-wide"},Fe={key:1,class:"space-y-6"},ze={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},We=["onClick"],je={class:"flex items-center space-x-3"},Pe={class:"font-medium text-gray-900"},qe={class:"text-xs text-gray-600"},He={key:0,class:"grid grid-cols-2 gap-4"},Ye={key:0,class:"text-brand-red text-xs mt-1"},Ne=["value"],Le={key:1,class:"grid grid-cols-2 gap-4"},Re={key:0,class:"text-red-600 text-xs mt-1"},Qe=["value"],Be={key:2,class:"space-y-4"},Ge={class:"flex flex-wrap gap-2"},Je=["onClick"],Xe={key:0,class:"text-red-600 text-xs mt-1"},Ke={class:"grid grid-cols-2 gap-4"},Ze=["value"],et={key:3,class:"grid grid-cols-3 gap-4"},tt={key:0,class:"text-red-600 text-xs mt-1"},lt=["value"],st={key:4,class:"space-y-4"},at={key:0,class:"text-red-600 text-xs mt-1"},nt=["value"],ot={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},rt={class:"space-y-1"},it={class:"text-blue-700 font-mono"},ut={class:"text-blue-600"},dt={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ct={class:"flex items-center space-x-2"},vt={class:"text-sm text-gray-900 font-mono"},mt={key:2,class:"space-y-6"},bt={class:"space-y-4"},xt={class:"block"},pt={class:"flex items-center justify-between mb-1"},gt={class:"text-sm font-medium text-gray-700"},ft={key:0,class:"text-red-500"},yt={class:"text-xs text-gray-600"},wt={key:0},ht=["onUpdate:modelValue","required"],kt={class:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2"},_t={class:"flex flex-wrap gap-1"},$t=["onClick"],Dt={class:"text-xs text-blue-700 mt-2"},Et={key:0,class:"mt-2"},Ct={class:"text-xs text-gray-600"},St={class:"font-mono"},Mt=["onUpdate:modelValue","type","required","placeholder"],Vt={key:2,class:"flex items-center"},Tt=["onUpdate:modelValue","id"],It=["for"],Ot={key:3,class:"text-xs text-gray-600 mt-1"},Ut={key:4,class:"text-xs text-gray-400 mt-1"},At={key:3,class:"space-y-6"},Ft={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2"},zt={class:"flex items-center space-x-2 text-blue-900"},Wt={class:"font-semibold"},jt={class:"flex items-center space-x-2 text-blue-800"},Pt={class:"text-sm font-mono"},qt={key:0,class:"flex items-center space-x-2 text-blue-800"},Ht={class:"text-sm"},Yt={class:"border-t border-gray-200 pt-4"},Nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Lt={class:"flex items-center justify-between pt-4 border-t border-gray-200"},Rt={__name:"ScheduleWizard",props:{availableFlows:{type:Array,required:!0},flowInputs:{type:Array,default:()=>[]}},emits:["submit","cancel","flow-selected"],setup(I,{emit:G}){const D=I,L=G,g=E(1),O=j(()=>D.flowInputs.length>0?4:3),l=E({flowId:"",scheduleType:"interval",intervalValue:30,intervalUnit:"minutes",time:"09:00",timezone:"UTC",daysOfWeek:[],dayOfMonth:1,cronExpression:"",inputData:{},maxExecutions:null,expiresAt:""}),c=E({}),$=["UTC","America/Sao_Paulo","America/New_York","Europe/London","Asia/Tokyo","Australia/Sydney"],U=[{value:0,label:"Domingo",short:"Dom"},{value:1,label:"Segunda",short:"Seg"},{value:2,label:"Terça",short:"Ter"},{value:3,label:"Quarta",short:"Qua"},{value:4,label:"Quinta",short:"Qui"},{value:5,label:"Sexta",short:"Sex"},{value:6,label:"Sábado",short:"Sáb"}],te=[{value:"minutes",label:"Minutos"},{value:"hours",label:"Horas"},{value:"days",label:"Dias"}],P=[{value:"interval",label:"Intervalo",icon:"lucide:clock",description:"Repetir a cada X minutos/horas/dias"},{value:"daily",label:"Diário",icon:"lucide:calendar",description:"Todo dia em horário específico"},{value:"weekly",label:"Semanal",icon:"lucide:calendar-days",description:"Dias específicos da semana"},{value:"monthly",label:"Mensal",icon:"lucide:calendar-range",description:"Dia específico do mês"},{value:"cron",label:"Cron",icon:"lucide:terminal",description:"Expressão cron personalizada"}],S=[{label:"Hoje",value:"{{today}}"},{label:"Ontem",value:"{{yesterday}}"},{label:"Amanhã",value:"{{tomorrow}}"},{label:"Últimos 7 dias",value:"{{today - 7 days}}"},{label:"Últimos 30 dias",value:"{{today - 30 days}}"},{label:"Início do Mês",value:"{{startOfMonth}}"},{label:"Fim do Mês",value:"{{endOfMonth}}"},{label:"Última Execução",value:"{{lastExecution}}"}],q=[{expr:"0 */2 * * *",desc:"A cada 2 horas"},{expr:"0 9 * * *",desc:"Todo dia às 9:00"},{expr:"0 9 * * 1-5",desc:"Dias úteis às 9:00"},{expr:"0 0 1 * *",desc:"Primeiro dia do mês à meia-noite"}];function H(){if(c.value={},g.value===1&&!l.value.flowId)return c.value.flowId="Por favor selecione um fluxo",!1;if(g.value===2)switch(l.value.scheduleType){case"interval":if(l.value.intervalUnit==="minutes"&&l.value.intervalValue<5)return c.value.intervalValue="Intervalo mínimo é 5 minutos",!1;if(!l.value.intervalValue||l.value.intervalValue<=0)return c.value.intervalValue="Valor do intervalo deve ser maior que 0",!1;break;case"daily":if(!l.value.time)return c.value.time="Horário é obrigatório",!1;break;case"weekly":if(!l.value.daysOfWeek||l.value.daysOfWeek.length===0)return c.value.daysOfWeek="Selecione pelo menos um dia",!1;if(!l.value.time)return c.value.time="Horário é obrigatório",!1;break;case"monthly":if(!l.value.dayOfMonth||l.value.dayOfMonth<1||l.value.dayOfMonth>31)return c.value.dayOfMonth="Dia deve estar entre 1 e 31",!1;if(!l.value.time)return c.value.time="Horário é obrigatório",!1;break;case"cron":if(!l.value.cronExpression)return c.value.cronExpression="Expressão cron é obrigatória",!1;break}return!0}function Y(){H()&&(g.value===1&&L("flow-selected",l.value.flowId),g.value===2&&D.flowInputs.length===0?g.value=4:g.value++)}function M(){g.value===4&&D.flowInputs.length===0?g.value=2:g.value--}function J(){if(!H())return;const i={flowId:l.value.flowId,scheduleType:l.value.scheduleType,inputData:l.value.inputData};switch(l.value.maxExecutions&&(i.maxExecutions=parseInt(l.value.maxExecutions)),l.value.expiresAt&&(i.expiresAt=new Date(l.value.expiresAt).toISOString()),l.value.scheduleType){case"interval":i.intervalValue=parseInt(l.value.intervalValue),i.intervalUnit=l.value.intervalUnit;break;case"daily":i.time=l.value.time,i.timezone=l.value.timezone;break;case"weekly":i.daysOfWeek=l.value.daysOfWeek,i.time=l.value.time,i.timezone=l.value.timezone;break;case"monthly":i.dayOfMonth=parseInt(l.value.dayOfMonth),i.time=l.value.time,i.timezone=l.value.timezone;break;case"cron":i.cronExpression=l.value.cronExpression,i.timezone=l.value.timezone;break}L("submit",i)}function X(i){const s=l.value.daysOfWeek.indexOf(i);s>-1?l.value.daysOfWeek.splice(s,1):l.value.daysOfWeek.push(i)}function w(i){return l.value.daysOfWeek.includes(i)}function A(i){return{string:"text",number:"number",boolean:"checkbox",email:"email",url:"url",date:"text",datetime:"text"}[i]||"text"}function R(i){return i.type==="date"||i.type==="datetime"}function F(i){return!i||typeof i!="string"?!1:i.includes("{{")&&i.includes("}}")}function le(i,s="YYYY-MM-DD"){if(!F(i))return null;const h=new Date,t=(m,Q)=>{const ne=m.getFullYear(),z=String(m.getMonth()+1).padStart(2,"0"),oe=String(m.getDate()).padStart(2,"0");return Q.replace("YYYY",ne).replace("MM",z).replace("DD",oe)};try{if(i.includes("{{today}}"))return t(h,s);if(i.includes("{{yesterday}}")){const m=new Date(h);return m.setDate(m.getDate()-1),t(m,s)}if(i.includes("{{tomorrow}}")){const m=new Date(h);return m.setDate(m.getDate()+1),t(m,s)}return`Will be calculated: ${i}`}catch(m){return"Invalid expression"}}function se(i,s){l.value.inputData[i]=s}function N(i){return(i==null?void 0:i.id)||(i==null?void 0:i._id)}const ae=j(()=>D.availableFlows.find(i=>N(i)===l.value.flowId)),K=j(()=>{switch(l.value.scheduleType){case"interval":return`Every ${l.value.intervalValue} ${l.value.intervalUnit}`;case"daily":return`Every day at ${l.value.time} (${l.value.timezone})`;case"weekly":return l.value.daysOfWeek.length===0?"Select days":`${l.value.daysOfWeek.sort((s,h)=>s-h).map(s=>{var h;return(h=U.find(t=>t.value===s))==null?void 0:h.short}).join(", ")} at ${l.value.time} (${l.value.timezone})`;case"monthly":return`Every month on day ${l.value.dayOfMonth} at ${l.value.time} (${l.value.timezone})`;case"cron":return l.value.cronExpression||"Enter cron expression";default:return""}});return(i,s)=>{var h;return a(),n("div",Ee,[e("div",Ce,[(a(!0),n(k,null,_(O.value,t=>(a(),n("div",{key:t,class:f(["flex items-center",{"flex-1":t<O.value}])},[e("div",{class:f(["w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-all",g.value>=t?"bg-brand-purple text-white":"bg-gray-100 text-gray-600 border border-gray-200"])},[g.value>t?(a(),re(b(p),{key:0,icon:"lucide:check",class:"w-5 h-5"})):(a(),n("span",Se,d(t),1))],2),t<O.value?(a(),n("div",{key:0,class:f(["h-1 flex-1 mx-2 transition-all rounded",g.value>t?"bg-brand-purple":"bg-gray-200"])},null,2)):v("",!0)],2))),128))]),g.value===1?(a(),n("div",Me,[s[14]||(s[14]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2 tracking-wide"},"Selecionar Fluxo"),e("p",{class:"text-sm text-gray-700 mb-4 tracking-wide"},"Escolha o fluxo que deseja agendar")],-1)),e("div",Ve,[(a(!0),n(k,null,_(I.availableFlows,t=>(a(),n("button",{key:N(t),onClick:m=>l.value.flowId=N(t),class:f(["p-4 rounded-lg border-2 text-left transition-all",l.value.flowId===N(t)?"border-brand-purple bg-brand-purple/5":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"])},[e("div",Ie,[e("div",null,[e("div",Oe,d(t.name),1),e("div",Ue,d(t.description||"Sem descrição"),1)]),l.value.flowId===N(t)?(a(),re(b(p),{key:0,icon:"lucide:check-circle",class:"w-6 h-6 text-brand-purple"})):v("",!0)])],10,Te))),128))]),c.value.flowId?(a(),n("p",Ae,d(c.value.flowId),1)):v("",!0)])):v("",!0),g.value===2?(a(),n("div",Fe,[s[30]||(s[30]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2 tracking-wide"},"Configurar Agendamento"),e("p",{class:"text-sm text-gray-700 mb-4 tracking-wide"},"Defina quando e com que frequência este fluxo deve ser executado")],-1)),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-900 mb-3 tracking-wide"},"Tipo de Agendamento",-1)),e("div",ze,[(a(),n(k,null,_(P,t=>e("button",{key:t.value,onClick:m=>l.value.scheduleType=t.value,class:f(["p-4 rounded-lg border-2 text-left transition-all",l.value.scheduleType===t.value?"border-brand-purple bg-brand-purple/5":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"])},[e("div",je,[x(b(p),{icon:t.icon,class:f(["w-6 h-6",l.value.scheduleType===t.value?"text-brand-purple":"text-gray-400"])},null,8,["icon","class"]),e("div",null,[e("div",Pe,d(t.label),1),e("div",qe,d(t.description),1)])])],10,We)),64))])]),l.value.scheduleType==="interval"?(a(),n("div",He,[e("div",null,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Valor do Intervalo",-1)),y(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>l.value.intervalValue=t),type:"number",min:"1",class:f(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all",{"border-brand-red":c.value.intervalValue}])},null,2),[[T,l.value.intervalValue,void 0,{number:!0}]]),c.value.intervalValue?(a(),n("p",Ye,d(c.value.intervalValue),1)):v("",!0)]),e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Unidade",-1)),y(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>l.value.intervalUnit=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},[(a(),n(k,null,_(te,t=>e("option",{key:t.value,value:t.value},d(t.label),9,Ne)),64))],512),[[B,l.value.intervalUnit]])])])):v("",!0),l.value.scheduleType==="daily"?(a(),n("div",Le,[e("div",null,[s[18]||(s[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Time",-1)),y(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>l.value.time=t),type:"time",class:f(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all",{"border-red-500":c.value.time}])},null,2),[[T,l.value.time]]),c.value.time?(a(),n("p",Re,d(c.value.time),1)):v("",!0)]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),y(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},[(a(),n(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,Qe)),64))],512),[[B,l.value.timezone]])])])):v("",!0),l.value.scheduleType==="weekly"?(a(),n("div",Be,[e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Days of Week",-1)),e("div",Ge,[(a(),n(k,null,_(U,t=>e("button",{key:t.value,onClick:ee(m=>X(t.value),["prevent"]),class:f(["px-4 py-2 rounded-lg border-2 transition-all",w(t.value)?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 text-gray-600 hover:border-gray-300"])},d(t.short),11,Je)),64))]),c.value.daysOfWeek?(a(),n("p",Xe,d(c.value.daysOfWeek),1)):v("",!0)]),e("div",Ke,[e("div",null,[s[21]||(s[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Time",-1)),y(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>l.value.time=t),type:"time",class:f(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all",{"border-red-500":c.value.time}])},null,2),[[T,l.value.time]])]),e("div",null,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),y(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},[(a(),n(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,Ze)),64))],512),[[B,l.value.timezone]])])])])):v("",!0),l.value.scheduleType==="monthly"?(a(),n("div",et,[e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Day of Month",-1)),y(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.value.dayOfMonth=t),type:"number",min:"1",max:"31",class:f(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all",{"border-red-500":c.value.dayOfMonth}])},null,2),[[T,l.value.dayOfMonth,void 0,{number:!0}]]),c.value.dayOfMonth?(a(),n("p",tt,d(c.value.dayOfMonth),1)):v("",!0)]),e("div",null,[s[24]||(s[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Time",-1)),y(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>l.value.time=t),type:"time",class:f(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all",{"border-red-500":c.value.time}])},null,2),[[T,l.value.time]])]),e("div",null,[s[25]||(s[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),y(e("select",{"onUpdate:modelValue":s[8]||(s[8]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},[(a(),n(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,lt)),64))],512),[[B,l.value.timezone]])])])):v("",!0),l.value.scheduleType==="cron"?(a(),n("div",st,[e("div",null,[s[26]||(s[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Cron Expression",-1)),y(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>l.value.cronExpression=t),type:"text",placeholder:"0 */2 * * *",class:f(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",{"border-red-500":c.value.cronExpression}])},null,2),[[T,l.value.cronExpression]]),c.value.cronExpression?(a(),n("p",at,d(c.value.cronExpression),1)):v("",!0)]),e("div",null,[s[27]||(s[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),y(e("select",{"onUpdate:modelValue":s[10]||(s[10]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},[(a(),n(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,nt)),64))],512),[[B,l.value.timezone]])]),e("div",ot,[s[28]||(s[28]=e("p",{class:"text-sm font-medium text-blue-900 mb-2"},"Common Examples:",-1)),e("div",rt,[(a(),n(k,null,_(q,t=>e("div",{key:t.expr,class:"flex items-center justify-between text-sm"},[e("code",it,d(t.expr),1),e("span",ut,d(t.desc),1)])),64))])])])):v("",!0),e("div",dt,[e("div",ct,[x(b(p),{icon:"lucide:info",class:"w-4 h-4 text-gray-600"}),s[29]||(s[29]=e("span",{class:"text-sm font-medium text-gray-700"},"Schedule Preview:",-1)),e("span",vt,d(K.value),1)])])])):v("",!0),g.value===3&&I.flowInputs.length>0?(a(),n("div",mt,[s[33]||(s[33]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Flow Input Data"),e("p",{class:"text-sm text-gray-600 mb-4"},"Provide data that will be used in each execution")],-1)),e("div",bt,[(a(!0),n(k,null,_(I.flowInputs,t=>(a(),n("div",{key:t.name,class:"space-y-2"},[e("label",xt,[e("div",pt,[e("span",gt,[Z(d(t.name)+" ",1),t.required?(a(),n("span",ft,"*")):v("",!0)]),e("span",yt,d(t.type),1)]),R(t)?(a(),n("div",wt,[y(e("textarea",{"onUpdate:modelValue":m=>l.value.inputData[t.name]=m,rows:"2",placeholder:"{{today}} or {{today - 7 days}}",required:t.required,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"},null,8,ht),[[T,l.value.inputData[t.name]]]),e("div",kt,[s[31]||(s[31]=e("p",{class:"text-xs font-medium text-blue-900 mb-2"},"💡 Quick Insert:",-1)),e("div",_t,[(a(),n(k,null,_(S,m=>e("button",{key:m.value,onClick:ee(Q=>se(t.name,m.value),["prevent"]),type:"button",class:"text-xs bg-white hover:bg-blue-100 px-2 py-1 rounded border border-blue-300 transition-colors"},d(m.label),9,$t)),64))]),e("p",Dt," Format: "+d(t.dateFormat||"YYYY-MM-DD"),1)]),F(l.value.inputData[t.name])?(a(),n("div",Et,[e("p",Ct,[s[32]||(s[32]=Z(" 📅 Preview: ",-1)),e("span",St,d(le(l.value.inputData[t.name],t.dateFormat)),1)])])):v("",!0)])):t.type!=="boolean"?y((a(),n("input",{key:1,"onUpdate:modelValue":m=>l.value.inputData[t.name]=m,type:A(t.type),required:t.required,placeholder:t.defaultValue!==void 0?String(t.defaultValue):"",class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},null,8,Mt)),[[xe,l.value.inputData[t.name]]]):(a(),n("div",Vt,[y(e("input",{"onUpdate:modelValue":m=>l.value.inputData[t.name]=m,type:"checkbox",id:`wizard-input-${t.name}`,class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,8,Tt),[[pe,l.value.inputData[t.name]]]),e("label",{for:`wizard-input-${t.name}`,class:"ml-2 text-sm text-gray-700"},d(t.description||"Enable"),9,It)])),t.description&&t.type!=="boolean"&&!R(t)?(a(),n("p",Ot,d(t.description),1)):v("",!0),t.nodeName?(a(),n("p",Ut,[x(b(p),{icon:"lucide:box",class:"w-3 h-3 inline mr-1"}),Z(" From: "+d(t.nodeName),1)])):v("",!0)])]))),128))])])):v("",!0),g.value===(I.flowInputs.length>0?4:3)?(a(),n("div",At,[s[39]||(s[39]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Review & Advanced Options"),e("p",{class:"text-sm text-gray-600 mb-4"},"Review your schedule and configure optional settings")],-1)),e("div",Ft,[e("div",zt,[x(b(p),{icon:"lucide:workflow",class:"w-5 h-5"}),e("span",Wt,d((h=ae.value)==null?void 0:h.name),1)]),e("div",jt,[x(b(p),{icon:"lucide:clock",class:"w-4 h-4"}),e("span",Pt,d(K.value),1)]),Object.keys(l.value.inputData).length>0?(a(),n("div",qt,[x(b(p),{icon:"lucide:input",class:"w-4 h-4"}),e("span",Ht,d(Object.keys(l.value.inputData).length)+" input(s) configured",1)])):v("",!0)]),e("div",Yt,[s[38]||(s[38]=e("h4",{class:"text-sm font-medium text-gray-700 mb-4"},"Advanced Options (Optional)",-1)),e("div",Nt,[e("div",null,[s[34]||(s[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Max Executions",-1)),y(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>l.value.maxExecutions=t),type:"number",min:"1",placeholder:"Unlimited",class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},null,512),[[T,l.value.maxExecutions,void 0,{number:!0}]]),s[35]||(s[35]=e("p",{class:"text-xs text-gray-600 mt-1"},"Leave empty for unlimited executions",-1))]),e("div",null,[s[36]||(s[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Expires At",-1)),y(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>l.value.expiresAt=t),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent transition-all"},null,512),[[T,l.value.expiresAt]]),s[37]||(s[37]=e("p",{class:"text-xs text-gray-600 mt-1"},"Schedule will stop after this date",-1))])])])])):v("",!0),e("div",Lt,[g.value>1?(a(),n("button",{key:0,onClick:M,type:"button",class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg bg-white hover:bg-gray-50 transition-all flex items-center space-x-2 font-medium"},[x(b(p),{icon:"lucide:arrow-left",class:"w-4 h-4"}),s[40]||(s[40]=e("span",null,"Voltar",-1))])):(a(),n("button",{key:1,onClick:s[13]||(s[13]=t=>i.$emit("cancel")),type:"button",class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg bg-white hover:bg-gray-50 transition-all font-medium"}," Cancelar ")),g.value<O.value?(a(),n("button",{key:2,onClick:Y,type:"button",class:"px-4 py-2 bg-brand-purple text-white rounded-lg hover:brightness-110 transition-all flex items-center space-x-2 font-medium"},[s[41]||(s[41]=e("span",null,"Próximo",-1)),x(b(p),{icon:"lucide:arrow-right",class:"w-4 h-4"})])):(a(),n("button",{key:3,onClick:J,type:"button",class:"px-4 py-2 bg-brand-green text-white rounded-lg hover:brightness-110 transition-all flex items-center space-x-2 font-medium"},[x(b(p),{icon:"lucide:check",class:"w-4 h-4"}),s[42]||(s[42]=e("span",null,"Criar Agendamento",-1))]))])])}}},Qt={class:"mb-8"},Bt={class:"flex items-center justify-between"},Gt={class:"mb-6"},Jt={class:"max-w-md"},Xt=["value"],Kt={key:0,class:"flex justify-center py-12"},Zt={key:1,class:"text-center py-12 glass-card backdrop-blur-xl bg-white/30 rounded-lg border border-white/20"},el={key:2},tl={class:"space-y-4"},ll={class:"flex items-start justify-between"},sl={class:"flex-1"},al={class:"flex items-center space-x-3 mb-2"},nl={class:"text-lg font-semibold text-gray-900"},ol={class:"text-sm text-gray-600 mb-3"},rl={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"},il={class:"flex items-center text-sm"},ul={class:"font-medium text-gray-900"},dl={key:0,class:"text-xs text-brand-purple"},cl={class:"flex items-center text-sm"},vl={class:"font-medium text-gray-900"},ml={key:0,class:"flex items-center text-sm"},bl={class:"font-medium text-brand-red"},xl={key:0,class:"bg-brand-orange/10 border border-brand-orange/30 rounded p-3 mb-3 backdrop-blur-sm"},pl={class:"flex items-start"},gl={class:"text-sm text-brand-orange"},fl={class:"flex items-center space-x-4 text-xs text-gray-600 tracking-wide"},yl={key:0},wl={key:1},hl={class:"flex items-center space-x-2 ml-4"},kl=["onClick","title"],_l=["onClick"],$l=["onClick"],Dl={key:0,class:"mt-6 flex items-center justify-between glass-card backdrop-blur-xl bg-white/30 rounded-lg border border-white/20 p-4"},El={class:"text-sm text-gray-700 tracking-wide"},Cl={class:"flex items-center space-x-2"},Sl=["disabled"],Ml={class:"flex items-center space-x-1"},Vl=["onClick"],Tl=["disabled"],Il={class:"sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between"},Ol={class:"p-6"},Ul={class:"flex items-center mb-4"},Al={class:"flex space-x-3"},Fl={__name:"SchedulesView",setup(I){const G=he(),{schedules:D,loading:L,getSchedules:g,deleteSchedule:O,enableSchedule:l,disableSchedule:c}=ce(),$=$e(),{getFlowInputs:U,getFlowOptions:te,flowOptions:P}=$,S=E(!1),q=E(!1),H=E(null),Y=E([]),M=E(""),J=E([]),X=E(!1),w=E(1),A=E(4);ge(()=>W(null,null,function*(){yield F(),yield le(),R(),window.addEventListener("resize",R)})),fe(()=>{window.removeEventListener("resize",R)});function R(){const r=window.innerHeight-376,V=Math.floor(r/280);A.value=Math.max(2,Math.min(6,V))}function F(){return W(this,null,function*(){const u={};M.value&&(u.flowId=M.value),yield g(u)})}function le(){return W(this,null,function*(){try{const u=yield te();u.success?Y.value=u.data.flows||P.value||[]:P.value&&(Y.value=P.value)}catch(u){P.value&&(Y.value=P.value)}})}function se(u){return W(this,null,function*(){var r;X.value=!0;const o=yield U(u);X.value=!1,o.success?J.value=((r=o.data.data)==null?void 0:r.inputs)||[]:J.value=[]})}function N(u){return W(this,null,function*(){const{createSchedule:o}=ce();(yield o(u)).success&&(S.value=!1,yield F())})}function ae(u){return W(this,null,function*(){u.enabled?yield c(u._id):yield l(u._id),yield F()})}function K(u){H.value=u,q.value=!0}function i(){return W(this,null,function*(){if(!H.value)return;(yield O(H.value._id)).success&&(q.value=!1,H.value=null,yield F())})}function s(u){G.push(`/executions?scheduleId=${u._id}`)}function h(u){return new Date(u).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function t(u){switch(u.scheduleType){case"interval":return`Every ${u.intervalValue} ${u.intervalUnit}`;case"daily":return`Daily at ${u.time} (${u.timezone})`;case"weekly":const o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return`${u.daysOfWeek.map(C=>o[C]).join(", ")} at ${u.time} (${u.timezone})`;case"monthly":return`Monthly on day ${u.dayOfMonth} at ${u.time} (${u.timezone})`;case"cron":return`Cron: ${u.cronExpression} (${u.timezone})`;default:return"Unknown schedule type"}}function m(u){if(!u)return null;const o=new Date,C=new Date(u)-o;if(C<0)return"Overdue";const V=Math.floor(C/(1e3*60*60)),ue=Math.floor(C%(1e3*60*60)/(1e3*60));if(V>24){const de=Math.floor(V/24);return`in ${de} day${de>1?"s":""}`}else return V>0?`in ${V}h ${ue}m`:`in ${ue}m`}const Q=j(()=>{let u=D.value;return M.value&&(u=u.filter(o=>o.flowId._id===M.value)),u}),ne=j(()=>{const u=(w.value-1)*A.value,o=u+A.value;return Q.value.slice(u,o)}),z=j(()=>Math.ceil(Q.value.length/A.value)),oe=j(()=>D.value.length>0),ie=j(()=>Q.value.length);function ve(u){u>=1&&u<=z.value&&(w.value=u)}function me(){w.value<z.value&&w.value++}function be(){w.value>1&&w.value--}return ye(M,()=>{w.value=1}),(u,o)=>(a(),re(ke,null,{default:we(()=>[e("div",Qt,[e("div",Bt,[o[11]||(o[11]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-gray-800 tracking-wide"},"Agendamentos"),e("p",{class:"text-gray-600 mt-2 text-sm tracking-wide"},"Automatize seus fluxos com execuções agendadas")],-1)),e("button",{onClick:o[0]||(o[0]=r=>S.value=!0),class:"bg-brand-purple hover:brightness-110 text-white px-5 py-2.5 rounded flex items-center space-x-2 transition-all shadow-sm hover:shadow-lg text-sm font-medium tracking-wide"},[x(b(p),{icon:"lucide:plus",class:"w-4 h-4"}),o[10]||(o[10]=e("span",null,"Criar Agendamento",-1))])])]),e("div",Gt,[e("div",Jt,[o[13]||(o[13]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wider"},"Filtrar por Fluxo",-1)),y(e("select",{"onUpdate:modelValue":o[1]||(o[1]=r=>M.value=r),onChange:F,class:"w-full px-3 py-2.5 bg-white/50 backdrop-blur-sm border border-gray-300 rounded text-gray-900 focus:outline-none focus:border-brand-purple focus:bg-white/70 transition-all text-sm"},[o[12]||(o[12]=e("option",{value:""},"Todos os Fluxos",-1)),(a(!0),n(k,null,_(Y.value,r=>(a(),n("option",{key:r.id||r._id,value:r.id||r._id},d(r.name),9,Xt))),128))],544),[[B,M.value]])])]),b(L)?(a(),n("div",Kt,[x(b(p),{icon:"lucide:loader-2",class:"w-8 h-8 animate-spin text-brand-purple"})])):oe.value?(a(),n("div",el,[e("div",tl,[(a(!0),n(k,null,_(ne.value,r=>{var C;return a(),n("div",{key:r._id,class:"glass-card backdrop-blur-xl bg-white/30 rounded-lg border border-white/20 p-6 hover:shadow-xl hover:bg-white/40 transition-all"},[e("div",ll,[e("div",sl,[e("div",al,[e("h3",nl,d(((C=r.flowId)==null?void 0:C.name)||"Unknown Flow"),1),x(_e,{enabled:r.enabled,"is-currently-running":r.isCurrentlyRunning,"paused-reason":r.pausedReason},null,8,["enabled","is-currently-running","paused-reason"])]),e("p",ol,d(t(r)),1),e("div",rl,[e("div",il,[x(b(p),{icon:"lucide:calendar-clock",class:"w-4 h-4 text-brand-purple mr-2"}),e("div",null,[o[17]||(o[17]=e("div",{class:"text-gray-600 text-xs"},"Próxima execução:",-1)),e("div",ul,d(r.nextExecutionAt?h(r.nextExecutionAt):"N/A"),1),r.enabled&&r.nextExecutionAt?(a(),n("div",dl,d(m(r.nextExecutionAt)),1)):v("",!0)])]),e("div",cl,[x(b(p),{icon:"lucide:activity",class:"w-4 h-4 text-brand-green mr-2"}),e("div",null,[o[18]||(o[18]=e("div",{class:"text-gray-600 text-xs"},"Total de execuções:",-1)),e("div",vl,d(r.executionCount||0),1),r.lastExecutionStatus?(a(),n("div",{key:0,class:f(["text-xs",r.lastExecutionStatus==="success"?"text-brand-green":"text-brand-red"])}," Última: "+d(r.lastExecutionStatus==="success"?"sucesso":"falhou"),3)):v("",!0)])]),r.consecutiveFailures>0?(a(),n("div",ml,[x(b(p),{icon:"lucide:alert-triangle",class:"w-4 h-4 text-brand-red mr-2"}),e("div",null,[o[19]||(o[19]=e("div",{class:"text-gray-600 text-xs"},"Falhas consecutivas:",-1)),e("div",bl,d(r.consecutiveFailures),1)])])):v("",!0)]),r.pausedReason?(a(),n("div",xl,[e("div",pl,[x(b(p),{icon:"lucide:alert-circle",class:"w-4 h-4 text-brand-orange mr-2 mt-0.5"}),e("div",gl,[o[20]||(o[20]=e("strong",null,"Pausado:",-1)),Z(" "+d(r.pausedReason),1)])])])):v("",!0),e("div",fl,[e("span",null,"Criado "+d(h(r.createdAt)),1),r.maxExecutions?(a(),n("span",yl," Máx execuções: "+d(r.maxExecutions),1)):v("",!0),r.expiresAt?(a(),n("span",wl," Expira: "+d(h(r.expiresAt)),1)):v("",!0)])]),e("div",hl,[e("button",{onClick:V=>ae(r),title:r.enabled?"Desabilitar":"Habilitar",class:f(["p-2 rounded transition-all",r.enabled?"text-brand-orange hover:bg-white/30":"text-brand-green hover:bg-white/30"])},[x(b(p),{icon:r.enabled?"lucide:pause-circle":"lucide:play-circle",class:"w-5 h-5"},null,8,["icon"])],10,kl),e("button",{onClick:V=>s(r),title:"Ver Execuções",class:"p-2 text-brand-purple hover:bg-white/30 rounded transition-all"},[x(b(p),{icon:"lucide:history",class:"w-5 h-5"})],8,_l),e("button",{onClick:V=>K(r),title:"Excluir",class:"p-2 text-brand-red hover:bg-white/30 rounded transition-all"},[x(b(p),{icon:"lucide:trash-2",class:"w-5 h-5"})],8,$l)])])])}),128))]),z.value>1?(a(),n("div",Dl,[e("div",El," Mostrando "+d((w.value-1)*A.value+1)+"-"+d(Math.min(w.value*A.value,ie.value))+" de "+d(ie.value),1),e("div",Cl,[e("button",{onClick:be,disabled:w.value===1,class:f(["px-3 py-2 rounded transition-all text-sm font-medium tracking-wide",w.value===1?"text-gray-400 cursor-not-allowed":"text-brand-purple hover:bg-white/40"])},[x(b(p),{icon:"lucide:chevron-left",class:"w-4 h-4"})],10,Sl),e("div",Ml,[(a(!0),n(k,null,_(z.value,r=>(a(),n("button",{key:r,onClick:C=>ve(r),class:f(["px-3 py-1.5 rounded text-sm font-medium tracking-wide transition-all",r===w.value?"bg-brand-purple text-white":"text-gray-700 hover:bg-white/40"])},d(r),11,Vl))),128))]),e("button",{onClick:me,disabled:w.value===z.value,class:f(["px-3 py-2 rounded transition-all text-sm font-medium tracking-wide",w.value===z.value?"text-gray-400 cursor-not-allowed":"text-brand-purple hover:bg-white/40"])},[x(b(p),{icon:"lucide:chevron-right",class:"w-4 h-4"})],10,Tl)])])):v("",!0)])):(a(),n("div",Zt,[x(b(p),{icon:"lucide:clock",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),o[15]||(o[15]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum agendamento ainda",-1)),o[16]||(o[16]=e("p",{class:"text-gray-600 mb-6 text-sm tracking-wide"},"Crie seu primeiro agendamento para automatizar a execução de fluxos",-1)),e("button",{onClick:o[2]||(o[2]=r=>S.value=!0),class:"bg-brand-purple hover:brightness-110 text-white px-5 py-2.5 rounded transition-all inline-flex items-center space-x-2 text-sm font-medium tracking-wide"},[x(b(p),{icon:"lucide:plus",class:"w-4 h-4"}),o[14]||(o[14]=e("span",null,"Criar Primeiro Agendamento",-1))])])),S.value?(a(),n("div",{key:3,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:o[6]||(o[6]=r=>S.value=!1)},[e("div",{class:"bg-white rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:o[5]||(o[5]=ee(()=>{},["stop"]))},[e("div",Il,[o[21]||(o[21]=e("h2",{class:"text-xl font-bold text-gray-900 tracking-wide"},"Criar Agendamento",-1)),e("button",{onClick:o[3]||(o[3]=r=>S.value=!1),class:"text-gray-500 hover:text-gray-700 hover:bg-gray-100 p-1 rounded transition-all"},[x(b(p),{icon:"lucide:x",class:"w-6 h-6"})])]),e("div",Ol,[x(Rt,{"available-flows":Y.value,"flow-inputs":J.value,onFlowSelected:se,onSubmit:N,onCancel:o[4]||(o[4]=r=>S.value=!1)},null,8,["available-flows","flow-inputs"])])])])):v("",!0),q.value?(a(),n("div",{key:4,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:o[9]||(o[9]=r=>q.value=!1)},[e("div",{class:"glass-card backdrop-blur-xl bg-white/30 rounded-lg border border-white/20 p-6 max-w-sm w-full mx-4",onClick:o[8]||(o[8]=ee(()=>{},["stop"]))},[e("div",Ul,[x(b(p),{icon:"lucide:alert-triangle",class:"w-6 h-6 text-brand-red mr-3"}),o[22]||(o[22]=e("h3",{class:"text-lg font-semibold text-gray-900 tracking-wide"},"Excluir Agendamento",-1))]),o[23]||(o[23]=e("p",{class:"text-gray-700 mb-6 text-sm tracking-wide"}," Tem certeza que deseja excluir este agendamento? Esta ação não pode ser desfeita. ",-1)),e("div",Al,[e("button",{onClick:o[7]||(o[7]=r=>q.value=!1),class:"flex-1 px-4 py-2.5 bg-white/50 backdrop-blur-sm border border-gray-300 text-gray-700 rounded hover:bg-white/70 hover:brightness-95 transition-all text-sm font-medium tracking-wide"}," Cancelar "),e("button",{onClick:i,class:"flex-1 px-4 py-2.5 bg-brand-red text-white rounded hover:brightness-110 transition-all text-sm font-medium tracking-wide"}," Excluir ")])])])):v("",!0)]),_:1}))}},Ll=De(Fl,[["__scopeId","data-v-a424753e"]]);export{Ll as default};
