var n=(u,i,g)=>new Promise((I,T)=>{var k=f=>{try{E(g.next(f))}catch(w){T(w)}},p=f=>{try{E(g.throw(f))}catch(w){T(w)}},E=f=>f.done?I(f.value):Promise.resolve(f.value).then(k,p);E((g=g.apply(u,i)).next())});import{c as D,r as b,z as W}from"./vue-vendor-Cs4IDGu-.js";import{a as $}from"./utils-nSMfNdYQ.js";const j="http://localhost:3001/api",c=$.create({baseURL:j,timeout:1e4});c.interceptors.request.use(u=>{const i=localStorage.getItem("accessToken");return i&&(u.headers.Authorization=`Bearer ${i}`),u},u=>Promise.reject(u));c.interceptors.response.use(u=>u,u=>n(null,null,function*(){var T;const i=u.config;if(["/auth/login","/auth/register","/auth/2fa/login","/auth/refresh"].some(k=>{var p;return(p=i.url)==null?void 0:p.includes(k)}))return Promise.reject(u);if(((T=u.response)==null?void 0:T.status)===401&&!i._retry){i._retry=!0;const k=localStorage.getItem("refreshToken");if(k)try{const p=yield $.post(`${j}/auth/refresh`,{refreshToken:k}),{data:E}=p.data,{tokens:f}=E,{accessToken:w,refreshToken:F}=f;return localStorage.setItem("accessToken",w),localStorage.setItem("refreshToken",F),i.headers.Authorization=`Bearer ${w}`,c(i)}catch(p){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(p)}else localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login"}return Promise.reject(u)}));const h=b(null),P=b(localStorage.getItem("accessToken")),z=b(localStorage.getItem("refreshToken")),t=b(!1);let A=null;function ee(){const u=W(),i=D(()=>!!P.value);function g(r,s){P.value=r,z.value=s,localStorage.setItem("accessToken",r),localStorage.setItem("refreshToken",s)}function I(){h.value=null,P.value=null,z.value=null,localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}function T(r,s){return n(this,null,function*(){var e,a,o,v;try{t.value=!0;const d=yield c.post("/auth/login",{email:r,password:s}),{data:l}=d.data;if(l.requires2FA)return{success:!0,requires2FA:!0,tempToken:l.tempToken};const{user:y,tokens:m}=l,{accessToken:S,refreshToken:R}=m;return h.value=y,g(S,R),u.push("/dashboard"),{success:!0}}catch(d){const l=((a=(e=d.response)==null?void 0:e.data)==null?void 0:a.error)||{},y=((v=(o=d.response)==null?void 0:o.data)==null?void 0:v.message)||l.message||"Erro ao fazer login",m=l.data||null;return{success:!1,error:y,attemptsInfo:m}}finally{t.value=!1}})}function k(r,s){return n(this,null,function*(){var e,a,o,v;try{t.value=!0;const d=yield c.post("/auth/2fa/login",{tempToken:r,token:s}),{data:l}=d.data,{user:y,tokens:m}=l,{accessToken:S,refreshToken:R}=m;return h.value=y,g(S,R),yield new Promise(Q=>setTimeout(Q,50)),window.location.href="/dashboard",{success:!0}}catch(d){const l=((a=(e=d.response)==null?void 0:e.data)==null?void 0:a.error)||{},y=((v=(o=d.response)==null?void 0:o.data)==null?void 0:v.message)||l.message||"Código inválido ou expirado",m=l.data||null;return{success:!1,error:y,attemptsInfo:m}}finally{t.value=!1}})}function p(r,s,e){return n(this,null,function*(){var a,o;try{t.value=!0;const v=yield c.post("/auth/register",{name:r,email:s,password:e}),{data:d}=v.data,{user:l,tokens:y}=d,{accessToken:m,refreshToken:S}=y;return h.value=l,g(m,S),u.push("/dashboard"),{success:!0}}catch(v){return{success:!1,error:((o=(a=v.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao criar conta"}}finally{t.value=!1}})}function E(){return n(this,null,function*(){I(),u.push("/login")})}function f(r=!1){return n(this,null,function*(){return!r&&h.value?{success:!0,data:h.value}:(!r&&A||(r&&(A=null),A=n(null,null,function*(){var s,e;try{t.value=!0;const a=yield c.get("/auth/profile"),o=a.data.data||a.data;return h.value=o,{success:!0,data:o}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao buscar perfil"}}finally{t.value=!1,A=null}})),A)})}function w(r){return n(this,null,function*(){var s,e;try{t.value=!0;const a=yield c.put("/auth/profile",r),o=a.data.data||a.data;return h.value=o,{success:!0,data:o}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao atualizar perfil"}}finally{t.value=!1}})}function F(r,s){return n(this,null,function*(){var e,a;try{return t.value=!0,yield c.put("/auth/change-password",{currentPassword:r,newPassword:s}),{success:!0}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao alterar senha"}}finally{t.value=!1}})}function q(){return n(this,null,function*(){var r,s;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/send-verification")).data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao enviar email de verificação"}}finally{t.value=!1}})}function _(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/verify-email",{token:r})).data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao verificar email"}}finally{t.value=!1}})}function x(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/forgot-password",{email:r})).data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao solicitar reset de senha"}}finally{t.value=!1}})}function B(r,s){return n(this,null,function*(){var e,a;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/reset-password",{token:r,newPassword:s})).data}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao redefinir senha"}}finally{t.value=!1}})}function L(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/preferences")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter preferências"}}})}function C(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.put("/auth/preferences",r)).data.data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao atualizar preferências"}}finally{t.value=!1}})}function M(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/profile/stats")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter estatísticas"}}})}function U(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/sessions")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter sessões"}}})}function V(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.delete(`/auth/sessions/${r}`)).data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao revogar sessão"}}finally{t.value=!1}})}function G(){return n(this,null,function*(){var r,s;try{return t.value=!0,{success:!0,data:(yield c.delete("/auth/sessions/all",{data:{refreshToken:z.value}})).data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao revogar todas as sessões"}}finally{t.value=!1}})}function H(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/connected-accounts")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter contas conectadas"}}})}function J(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/2fa/enable",{password:r})).data.data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao ativar 2FA"}}finally{t.value=!1}})}function K(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/2fa/verify",{token:r})).data.data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao verificar 2FA"}}finally{t.value=!1}})}function N(r,s){return n(this,null,function*(){var e,a;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/2fa/disable",{password:r,token:s})).data}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao desativar 2FA"}}finally{t.value=!1}})}function O(r,s){return n(this,null,function*(){var e,a;try{t.value=!0;const o=yield c.delete("/auth/account",{data:{password:r,confirmation:s}});return I(),u.push("/login"),{success:!0,data:o.data}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao deletar conta"}}finally{t.value=!1}})}return P.value&&!h.value&&f(),{user:D(()=>h.value),isAuthenticated:i,loading:D(()=>t.value),login:T,verify2FALogin:k,register:p,logout:E,getProfile:f,updateProfile:w,changePassword:F,sendVerificationEmail:q,verifyEmail:_,forgotPassword:x,resetPassword:B,getPreferences:L,updatePreferences:C,getProfileStats:M,getActiveSessions:U,revokeSession:V,revokeAllSessions:G,getConnectedAccounts:H,enable2FA:J,verify2FA:K,disable2FA:N,deleteAccount:O}}export{c as a,ee as u};
