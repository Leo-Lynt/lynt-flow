var c=(l,g,d)=>new Promise((o,F)=>{var b=f=>{try{v(d.next(f))}catch(x){F(x)}},$=f=>{try{v(d.throw(f))}catch(x){F(x)}},v=f=>f.done?o(f.value):Promise.resolve(f.value).then(b,$);v((d=d.apply(l,g)).next())});import{a as u}from"./useAuth-L5NC1uLI.js";import{r as h,c as p}from"./vue-vendor-BR4PrzJp.js";const w=h([]);let y=null;function K(){const l=h([]),g=h(null),d=h([]),o=h(!1);function F(){return c(this,arguments,function*(a={}){var s,r;try{o.value=!0;const e=yield u.get("/flows",{params:a}),t=e.data.data||e.data,n=(t==null?void 0:t.flows)||t||[];return l.value=n,{success:!0,data:t}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao buscar fluxos"}}finally{o.value=!1}})}function b(a=!1){return c(this,null,function*(){return!a&&w.value.length>0?{success:!0,data:{flows:w.value}}:(!a&&y||(a&&(y=null),y=c(null,null,function*(){var s,r,e;try{const t=yield u.get("/flows/options"),n=((s=t.data.data)==null?void 0:s.flows)||t.data.flows||[];return w.value=n,{success:!0,data:{flows:n}}}catch(t){return{success:!1,error:((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||"Erro ao buscar fluxos"}}finally{y=null}})),y)})}function $(a){return c(this,null,function*(){var s,r;try{o.value=!0;const e=yield u.get(`/flows/${a}`),t=e.data.data||e.data;return g.value=t,{success:!0,data:t}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||e.message||"Erro ao buscar fluxo"}}finally{o.value=!1}})}function v(a){return c(this,null,function*(){var s,r;try{o.value=!0;const e={name:a.name,description:a.description||"",category:a.category||"",isPublic:a.isPublic||!1},t=yield u.post("/flows",e),n=t.data.data||t.data;return l.value.unshift(n),w.value=[],{success:!0,data:n}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao criar fluxo"}}finally{o.value=!1}})}function f(a,s){return c(this,null,function*(){var r,e;try{o.value=!0;const t={name:s.name,description:s.description||"",isPublic:s.isPublic||!1,tags:s.tags||[],category:s.category||""};s.flowData&&(t.flowData=s.flowData);const n=yield u.put(`/flows/${a}`,t),i=l.value.findIndex(m=>m._id===a||m.id===a);return i!==-1&&(l.value[i]=n.data.data||n.data),g.value=n.data,w.value=[],{success:!0,data:n.data}}catch(t){return{success:!1,error:((e=(r=t.response)==null?void 0:r.data)==null?void 0:e.message)||"Erro ao atualizar fluxo"}}finally{o.value=!1}})}function x(a){return c(this,null,function*(){var s,r;try{return o.value=!0,yield u.delete(`/flows/${a}`),l.value=l.value.filter(e=>e._id!==a&&e.id!==a),w.value=[],{success:!0}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao deletar fluxo"}}finally{o.value=!1}})}function P(a){return c(this,null,function*(){var s,r;try{o.value=!0;const e=yield u.post(`/flows/${a}/clone`);return l.value.unshift(e.data),w.value=[],{success:!0,data:e.data}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao clonar fluxo"}}finally{o.value=!1}})}function O(a){return c(this,null,function*(){var s,r;try{return{success:!0,data:(yield u.get(`/flows/${a}/stats`)).data}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao buscar estatísticas"}}})}function A(a){return c(this,null,function*(){var s,r;try{return{success:!0,data:(yield u.get(`/flows/${a}/inputs`)).data}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao buscar inputs do fluxo"}}})}function I(r){return c(this,arguments,function*(a,s={}){var e,t,n,i,m;try{o.value=!0;const E={inputData:s};return{success:!0,data:(yield u.post(`/flows/${a}/execute`,E)).data}}catch(E){return{success:!1,error:((n=(t=(e=E.response)==null?void 0:e.data)==null?void 0:t.error)==null?void 0:n.message)||((m=(i=E.response)==null?void 0:i.data)==null?void 0:m.message)||"Erro ao executar fluxo"}}finally{o.value=!1}})}function _(){return c(this,null,function*(){var a,s;try{return o.value=!0,{success:!0,data:(yield u.get("/flows/public")).data.data}}catch(r){return{success:!1,error:((s=(a=r.response)==null?void 0:a.data)==null?void 0:s.message)||"Erro ao buscar fluxos públicos"}}finally{o.value=!1}})}function z(){return c(this,arguments,function*(a={}){var s,r,e,t,n;try{o.value=!0;const i=yield u.get("/executions",{params:a});return d.value=i.data.data||[],{success:!0,data:i.data.data,pagination:i.data.pagination}}catch(i){return{success:!1,error:((e=(r=(s=i.response)==null?void 0:s.data)==null?void 0:r.error)==null?void 0:e.message)||((n=(t=i.response)==null?void 0:t.data)==null?void 0:n.message)||"Erro ao buscar execuções"}}finally{o.value=!1}})}function C(a){return c(this,null,function*(){var s,r;try{return{success:!0,data:(yield u.get(`/executions/${a}/response`)).data}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao buscar execu��o"}}})}function L(a){return c(this,null,function*(){var s,r;try{return{success:!0,data:(yield u.post(`/executions/${a}/reexecute`)).data}}catch(e){return{success:!1,error:((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.message)||"Erro ao reexecutar fluxo"}}})}const S=p(()=>w.value),j=p(()=>l.value.length),k=p(()=>l.value.filter(a=>!a.archived)),q=p(()=>d.value.slice(0,5).sort((a,s)=>new Date(s.createdAt)-new Date(a.createdAt)));return{flows:p(()=>l.value),currentFlow:p(()=>g.value),executions:p(()=>d.value),loading:p(()=>o.value),flowOptions:S,totalFlows:j,activeFlows:k,recentExecutions:q,getFlows:F,getFlow:$,createFlow:v,updateFlow:f,deleteFlow:x,cloneFlow:P,getFlowStats:O,getFlowInputs:A,executeFlow:I,getPublicFlows:_,getFlowOptions:b,getExecutions:z,getExecution:C,reexecuteFlow:L}}export{K as u};
