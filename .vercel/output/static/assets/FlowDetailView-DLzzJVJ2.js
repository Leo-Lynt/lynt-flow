var m=(D,k,l)=>new Promise((d,h)=>{var S=x=>{try{_(l.next(x))}catch(v){h(v)}},C=x=>{try{_(l.throw(x))}catch(v){h(v)}},_=x=>x.done?d(x.value):Promise.resolve(x.value).then(S,C);_((l=l.apply(D,k)).next())});import{h as H,r as w,o as J,A as K,c as B,a as O,s as p,b as c,i as u,u as a,l as o,I as r,k as t,t as i,n as Q,F as N,C as V}from"./vue-vendor-BR4PrzJp.js";import{_ as W}from"./AppLayout-DfxNFnX7.js";import{B as y}from"./BaseCard-C5zSWQaB.js";import{_ as X}from"./ExecutionStatusBadge-DgNAHWYX.js";import{u as Y,_ as Z}from"./useSchedules-CY539rO_.js";import{u as tt}from"./useFlows-ZtHeo4Pl.js";import"./useAuth-L5NC1uLI.js";import"./utils-nSMfNdYQ.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const et={key:0,class:"flex justify-center items-center h-64"},st={key:1},nt={class:"flex items-center justify-between mb-6"},at={class:"text-2xl font-bold text-gray-900"},ot={class:"text-gray-600 mt-1"},it={class:"flex items-center space-x-3"},lt=["disabled"],ct={class:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8"},ut={class:"space-y-3"},dt={class:"flex justify-between"},rt={class:"font-medium"},xt={class:"flex justify-between"},ft={class:"font-medium"},mt={class:"space-y-3"},pt={class:"flex justify-between"},gt={class:"font-medium"},yt={class:"flex justify-between"},_t={class:"font-medium"},vt={class:"flex justify-between"},bt={class:"font-medium text-sm"},ht={class:"space-y-3"},wt={class:"flex justify-between"},kt={class:"font-medium text-sm"},St={class:"flex justify-between"},Ct={class:"font-medium text-sm"},Et={class:"flex justify-between"},Ft={class:"font-medium"},jt={key:0,class:"space-y-3"},Dt={class:"flex items-center space-x-3"},At={class:"font-medium text-gray-900"},Rt={class:"text-sm text-gray-600"},$t={key:1,class:"text-center py-8"},Bt={key:0,class:"space-y-3"},Nt=["onClick"],Vt={class:"flex items-center space-x-3"},Lt={class:"text-sm text-gray-600"},Tt={class:"text-xs text-gray-500"},It={key:1,class:"text-center py-8"},Ut={class:"bg-gray-50 border border-gray-200 rounded-lg h-64 flex items-center justify-center"},Pt={class:"text-center"},zt={class:"text-sm text-gray-400 mt-1"},Mt={key:2,class:"text-center py-8"},te={__name:"FlowDetailView",setup(D){const k=H(),l=K(),{currentFlow:d,loading:h,getFlow:S,executeFlow:C,getFlowStats:_,getExecutions:x}=tt(),{getSchedules:v}=Y(),f=k.params.id,b=w({}),g=w(!1),E=w([]),F=w([]);J(()=>m(null,null,function*(){yield L(),yield T(),yield I(),yield U()}));function L(){return m(this,null,function*(){(yield S(f)).success||l.push("/dashboard")})}function T(){return m(this,null,function*(){const s=yield _(f);s.success&&(b.value=s.data)})}function I(){return m(this,null,function*(){const s=yield x({flowId:f,limit:5,page:1});s.success&&(E.value=s.data||[])})}function U(){return m(this,null,function*(){const s=yield v({flowId:f,enabled:!0});s.success&&(F.value=s.data||[])})}const A=B(()=>{var s,e,n;return((n=(e=(s=d.value)==null?void 0:s.flowData)==null?void 0:e.nodes)==null?void 0:n.length)||0}),R=B(()=>{var s,e,n;return((n=(e=(s=d.value)==null?void 0:s.flowData)==null?void 0:e.edges)==null?void 0:n.length)||0});function P(){l.push(`/flows/${f}/edit`)}function z(){return m(this,null,function*(){g.value=!0;const s=yield C(f);g.value=!1,s.success&&l.push(`/executions/${s.data.id}`)})}function j(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}function $(s){return new Date(s).toLocaleDateString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function M(){l.push("/schedules")}function q(){l.push(`/executions?flowId=${f}`)}function G(s){l.push(`/executions/${s}`)}return(s,e)=>(c(),O(W,null,{default:p(()=>[a(h)?(c(),u("div",et,[o(a(r),{icon:"lucide:loader-2",class:"w-8 h-8 animate-spin text-gray-400"})])):a(d)?(c(),u("div",st,[t("div",nt,[t("div",null,[t("h1",at,i(a(d).name),1),t("p",ot,i(a(d).description||"No description"),1)]),t("div",it,[t("button",{onClick:z,disabled:g.value,class:"bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2"},[o(a(r),{icon:g.value?"lucide:loader-2":"lucide:play",class:Q(["w-4 h-4",{"animate-spin":g.value}])},null,8,["icon","class"]),t("span",null,i(g.value?"Executing...":"Execute"),1)],8,lt),t("button",{onClick:P,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2"},[o(a(r),{icon:"lucide:edit",class:"w-4 h-4"}),e[1]||(e[1]=t("span",null,"Edit",-1))])])]),t("div",ct,[o(y,{title:"Flow Structure"},{default:p(()=>[t("div",ut,[t("div",dt,[e[2]||(e[2]=t("span",{class:"text-gray-600"},"Nodes:",-1)),t("span",rt,i(A.value),1)]),t("div",xt,[e[3]||(e[3]=t("span",{class:"text-gray-600"},"Connections:",-1)),t("span",ft,i(R.value),1)]),e[4]||(e[4]=t("div",{class:"flex justify-between"},[t("span",{class:"text-gray-600"},"Status:"),t("span",{class:"px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs"},"Active")],-1))])]),_:1}),o(y,{title:"Execution Stats"},{default:p(()=>[t("div",mt,[t("div",pt,[e[5]||(e[5]=t("span",{class:"text-gray-600"},"Total Runs:",-1)),t("span",gt,i(b.value.totalExecutions||0),1)]),t("div",yt,[e[6]||(e[6]=t("span",{class:"text-gray-600"},"Success Rate:",-1)),t("span",_t,i(b.value.successRate||0)+"%",1)]),t("div",vt,[e[7]||(e[7]=t("span",{class:"text-gray-600"},"Last Run:",-1)),t("span",bt,i(b.value.lastExecution?j(b.value.lastExecution):"Never"),1)])])]),_:1}),o(y,{title:"Flow Details"},{default:p(()=>[t("div",ht,[t("div",wt,[e[8]||(e[8]=t("span",{class:"text-gray-600"},"Created:",-1)),t("span",kt,i(j(a(d).createdAt)),1)]),t("div",St,[e[9]||(e[9]=t("span",{class:"text-gray-600"},"Updated:",-1)),t("span",Ct,i(j(a(d).updatedAt)),1)]),t("div",Et,[e[10]||(e[10]=t("span",{class:"text-gray-600"},"Visibility:",-1)),t("span",Ft,i(a(d).isPublic?"Public":"Private"),1)])])]),_:1})]),o(y,{title:"Active Schedules",subtitle:"Automated execution schedules for this flow",class:"mb-8"},{default:p(()=>[F.value.length>0?(c(),u("div",jt,[(c(!0),u(N,null,V(F.value,n=>(c(),u("div",{key:n._id,class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg"},[t("div",Dt,[o(a(r),{icon:"lucide:clock",class:"w-5 h-5 text-gray-400"}),t("div",null,[t("div",At,i(n.scheduleType.charAt(0).toUpperCase()+n.scheduleType.slice(1))+" Schedule ",1),t("div",Rt," Next run: "+i($(n.nextExecutionAt)),1)])]),o(Z,{enabled:n.enabled,"is-currently-running":n.isCurrentlyRunning},null,8,["enabled","is-currently-running"])]))),128))])):(c(),u("div",$t,[o(a(r),{icon:"lucide:calendar-off",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e[12]||(e[12]=t("p",{class:"text-gray-500 mb-4"},"No active schedules for this flow",-1)),t("button",{onClick:M,class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 inline-flex items-center space-x-2"},[o(a(r),{icon:"lucide:plus",class:"w-4 h-4"}),e[11]||(e[11]=t("span",null,"Create Schedule",-1))])]))]),_:1}),o(y,{title:"Recent Executions",subtitle:"Latest execution history",class:"mb-8"},{default:p(()=>[E.value.length>0?(c(),u("div",Bt,[(c(!0),u(N,null,V(E.value,n=>(c(),u("div",{key:n._id,onClick:qt=>G(n._id),class:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors"},[t("div",Vt,[o(a(r),{icon:"lucide:play-circle",class:"w-5 h-5 text-gray-400"}),t("div",null,[t("div",Lt,i($(n.startedAt)),1),t("div",Tt," Triggered by: "+i(n.triggeredBy),1)])]),o(X,{status:n.status},null,8,["status"])],8,Nt))),128)),t("button",{onClick:q,class:"w-full text-center text-sm text-blue-600 hover:text-blue-700 py-2"}," View all executions â†’ ")])):(c(),u("div",It,[o(a(r),{icon:"lucide:inbox",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),e[13]||(e[13]=t("p",{class:"text-gray-500"},"No executions yet",-1))]))]),_:1}),o(y,{title:"Flow Diagram",subtitle:"Visual representation of your workflow"},{default:p(()=>[t("div",Ut,[t("div",Pt,[o(a(r),{icon:"lucide:workflow",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[14]||(e[14]=t("p",{class:"text-gray-500"},"Flow diagram preview",-1)),t("p",zt,i(A.value)+" nodes, "+i(R.value)+" connections",1)])])]),_:1})])):(c(),u("div",Mt,[o(a(r),{icon:"lucide:alert-circle",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[15]||(e[15]=t("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Flow not found",-1)),e[16]||(e[16]=t("p",{class:"text-gray-600 mb-4"},"The flow you're looking for doesn't exist or has been deleted.",-1)),t("button",{onClick:e[0]||(e[0]=n=>a(l).push("/dashboard")),class:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700"}," Back to Dashboard ")]))]),_:1}))}};export{te as default};
