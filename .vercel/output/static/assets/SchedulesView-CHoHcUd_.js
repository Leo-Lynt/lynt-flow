var W=(I,J,D)=>new Promise((L,f)=>{var O=$=>{try{c(D.next($))}catch(U){f(U)}},l=$=>{try{c(D.throw($))}catch(U){f(U)}},c=$=>$.done?L($.value):Promise.resolve($.value).then(O,l);c((D=D.apply(I,J)).next())});import{r as E,c as j,i as o,b as a,k as e,m,F as k,C as _,n as y,a as re,u as b,I as g,t as d,l as x,q as p,v as T,J as B,p as ee,z as Z,y as xe,E as ge,o as fe,L as ye,w as pe,s as we,A as he}from"./vue-vendor-BR4PrzJp.js";import{_ as ke}from"./AppLayout-DfxNFnX7.js";import{u as ce,_ as _e}from"./useSchedules-CY539rO_.js";import{u as $e}from"./useFlows-ZtHeo4Pl.js";import{_ as De}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./useAuth-L5NC1uLI.js";import"./utils-nSMfNdYQ.js";const Ee={class:"space-y-6"},Ce={class:"flex items-center justify-between mb-8"},Se={key:1},Me={key:0,class:"space-y-4"},Ve={class:"grid grid-cols-1 gap-3"},Te=["onClick"],Ie={class:"flex items-center justify-between"},Oe={class:"font-medium text-gray-900"},Ue={class:"text-sm text-gray-600 mt-1"},Fe={key:0,class:"text-red-600 text-sm tracking-wide"},ze={key:1,class:"space-y-6"},Ae={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3"},We=["onClick"],je={class:"flex items-center space-x-3"},Pe={class:"font-medium text-gray-900"},qe={class:"text-xs text-gray-600"},He={key:0,class:"grid grid-cols-2 gap-4"},Ye={key:0,class:"text-red-600 text-xs mt-1"},Ne=["value"],Le={key:1,class:"grid grid-cols-2 gap-4"},Re={key:0,class:"text-red-600 text-xs mt-1"},Qe=["value"],Be={key:2,class:"space-y-4"},Je={class:"flex flex-wrap gap-2"},Xe=["onClick"],Ge={key:0,class:"text-red-600 text-xs mt-1"},Ke={class:"grid grid-cols-2 gap-4"},Ze=["value"],et={key:3,class:"grid grid-cols-3 gap-4"},tt={key:0,class:"text-red-600 text-xs mt-1"},lt=["value"],st={key:4,class:"space-y-4"},at={key:0,class:"text-red-600 text-xs mt-1"},ot=["value"],nt={class:"bg-blue-50/50 border border-blue-200 rounded-lg p-4"},rt={class:"space-y-1"},it={class:"text-blue-700 font-mono"},ut={class:"text-blue-600"},dt={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ct={class:"flex items-center space-x-2"},mt={class:"text-sm text-gray-900 font-mono"},vt={key:2,class:"space-y-6"},bt={class:"space-y-4"},xt={class:"block"},gt={class:"flex items-center justify-between mb-1"},ft={class:"text-sm font-medium text-gray-700"},yt={key:0,class:"text-red-500"},pt={class:"text-xs text-gray-600"},wt={key:0},ht=["onUpdate:modelValue","required"],kt={class:"bg-blue-50 border border-blue-200 rounded-lg p-3 mt-2"},_t={class:"flex flex-wrap gap-1"},$t=["onClick"],Dt={class:"text-xs text-blue-700 mt-2"},Et={key:0,class:"mt-2"},Ct={class:"text-xs text-gray-600"},St={class:"font-mono"},Mt=["onUpdate:modelValue","type","required","placeholder"],Vt={key:2,class:"flex items-center"},Tt=["onUpdate:modelValue","id"],It=["for"],Ot={key:3,class:"text-xs text-gray-600 mt-1"},Ut={key:4,class:"text-xs text-gray-400 mt-1"},Ft={key:3,class:"space-y-6"},zt={class:"bg-blue-50 border border-blue-200 rounded-lg p-4 space-y-2"},At={class:"flex items-center space-x-2 text-blue-900"},Wt={class:"font-semibold"},jt={class:"flex items-center space-x-2 text-blue-800"},Pt={class:"text-sm font-mono"},qt={key:0,class:"flex items-center space-x-2 text-blue-800"},Ht={class:"text-sm"},Yt={class:"border-t border-gray-200 pt-4"},Nt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Lt={class:"flex items-center justify-between pt-4 border-t border-gray-200"},Rt={__name:"ScheduleWizard",props:{availableFlows:{type:Array,required:!0},flowInputs:{type:Array,default:()=>[]}},emits:["submit","cancel","flow-selected"],setup(I,{emit:J}){const D=I,L=J,f=E(1),O=j(()=>D.flowInputs.length>0?4:3),l=E({flowId:"",scheduleType:"interval",intervalValue:30,intervalUnit:"minutes",time:"09:00",timezone:"UTC",daysOfWeek:[],dayOfMonth:1,cronExpression:"",inputData:{},maxExecutions:null,expiresAt:""}),c=E({}),$=["UTC","America/Sao_Paulo","America/New_York","Europe/London","Asia/Tokyo","Australia/Sydney"],U=[{value:0,label:"Domingo",short:"Dom"},{value:1,label:"Segunda",short:"Seg"},{value:2,label:"Ter√ßa",short:"Ter"},{value:3,label:"Quarta",short:"Qua"},{value:4,label:"Quinta",short:"Qui"},{value:5,label:"Sexta",short:"Sex"},{value:6,label:"S√°bado",short:"S√°b"}],te=[{value:"minutes",label:"Minutos"},{value:"hours",label:"Horas"},{value:"days",label:"Dias"}],P=[{value:"interval",label:"Intervalo",icon:"lucide:clock",description:"Repetir a cada X minutos/horas/dias"},{value:"daily",label:"Di√°rio",icon:"lucide:calendar",description:"Todo dia em hor√°rio espec√≠fico"},{value:"weekly",label:"Semanal",icon:"lucide:calendar-days",description:"Dias espec√≠ficos da semana"},{value:"monthly",label:"Mensal",icon:"lucide:calendar-range",description:"Dia espec√≠fico do m√™s"},{value:"cron",label:"Cron",icon:"lucide:terminal",description:"Express√£o cron personalizada"}],S=[{label:"Hoje",value:"{{today}}"},{label:"Ontem",value:"{{yesterday}}"},{label:"Amanh√£",value:"{{tomorrow}}"},{label:"√öltimos 7 dias",value:"{{today - 7 days}}"},{label:"√öltimos 30 dias",value:"{{today - 30 days}}"},{label:"In√≠cio do M√™s",value:"{{startOfMonth}}"},{label:"Fim do M√™s",value:"{{endOfMonth}}"},{label:"√öltima Execu√ß√£o",value:"{{lastExecution}}"}],q=[{expr:"0 */2 * * *",desc:"A cada 2 horas"},{expr:"0 9 * * *",desc:"Todo dia √†s 9:00"},{expr:"0 9 * * 1-5",desc:"Dias √∫teis √†s 9:00"},{expr:"0 0 1 * *",desc:"Primeiro dia do m√™s √† meia-noite"}];function H(){if(c.value={},f.value===1&&!l.value.flowId)return c.value.flowId="Por favor selecione um fluxo",!1;if(f.value===2)switch(l.value.scheduleType){case"interval":if(l.value.intervalUnit==="minutes"&&l.value.intervalValue<5)return c.value.intervalValue="Intervalo m√≠nimo √© 5 minutos",!1;if(!l.value.intervalValue||l.value.intervalValue<=0)return c.value.intervalValue="Valor do intervalo deve ser maior que 0",!1;break;case"daily":if(!l.value.time)return c.value.time="Hor√°rio √© obrigat√≥rio",!1;break;case"weekly":if(!l.value.daysOfWeek||l.value.daysOfWeek.length===0)return c.value.daysOfWeek="Selecione pelo menos um dia",!1;if(!l.value.time)return c.value.time="Hor√°rio √© obrigat√≥rio",!1;break;case"monthly":if(!l.value.dayOfMonth||l.value.dayOfMonth<1||l.value.dayOfMonth>31)return c.value.dayOfMonth="Dia deve estar entre 1 e 31",!1;if(!l.value.time)return c.value.time="Hor√°rio √© obrigat√≥rio",!1;break;case"cron":if(!l.value.cronExpression)return c.value.cronExpression="Express√£o cron √© obrigat√≥ria",!1;break}return!0}function Y(){H()&&(f.value===1&&L("flow-selected",l.value.flowId),f.value===2&&D.flowInputs.length===0?f.value=4:f.value++)}function M(){f.value===4&&D.flowInputs.length===0?f.value=2:f.value--}function X(){if(!H())return;const i={flowId:l.value.flowId,scheduleType:l.value.scheduleType,inputData:l.value.inputData};switch(l.value.maxExecutions&&(i.maxExecutions=parseInt(l.value.maxExecutions)),l.value.expiresAt&&(i.expiresAt=new Date(l.value.expiresAt).toISOString()),l.value.scheduleType){case"interval":i.intervalValue=parseInt(l.value.intervalValue),i.intervalUnit=l.value.intervalUnit;break;case"daily":i.time=l.value.time,i.timezone=l.value.timezone;break;case"weekly":i.daysOfWeek=l.value.daysOfWeek,i.time=l.value.time,i.timezone=l.value.timezone;break;case"monthly":i.dayOfMonth=parseInt(l.value.dayOfMonth),i.time=l.value.time,i.timezone=l.value.timezone;break;case"cron":i.cronExpression=l.value.cronExpression,i.timezone=l.value.timezone;break}L("submit",i)}function G(i){const s=l.value.daysOfWeek.indexOf(i);s>-1?l.value.daysOfWeek.splice(s,1):l.value.daysOfWeek.push(i)}function w(i){return l.value.daysOfWeek.includes(i)}function F(i){return{string:"text",number:"number",boolean:"checkbox",email:"email",url:"url",date:"text",datetime:"text"}[i]||"text"}function R(i){return i.type==="date"||i.type==="datetime"}function z(i){return!i||typeof i!="string"?!1:i.includes("{{")&&i.includes("}}")}function le(i,s="YYYY-MM-DD"){if(!z(i))return null;const h=new Date,t=(v,Q)=>{const oe=v.getFullYear(),A=String(v.getMonth()+1).padStart(2,"0"),ne=String(v.getDate()).padStart(2,"0");return Q.replace("YYYY",oe).replace("MM",A).replace("DD",ne)};try{if(i.includes("{{today}}"))return t(h,s);if(i.includes("{{yesterday}}")){const v=new Date(h);return v.setDate(v.getDate()-1),t(v,s)}if(i.includes("{{tomorrow}}")){const v=new Date(h);return v.setDate(v.getDate()+1),t(v,s)}return`Will be calculated: ${i}`}catch(v){return"Invalid expression"}}function se(i,s){l.value.inputData[i]=s}function N(i){return(i==null?void 0:i.id)||(i==null?void 0:i._id)}const ae=j(()=>D.availableFlows.find(i=>N(i)===l.value.flowId)),K=j(()=>{switch(l.value.scheduleType){case"interval":return`Every ${l.value.intervalValue} ${l.value.intervalUnit}`;case"daily":return`Every day at ${l.value.time} (${l.value.timezone})`;case"weekly":return l.value.daysOfWeek.length===0?"Select days":`${l.value.daysOfWeek.sort((s,h)=>s-h).map(s=>{var h;return(h=U.find(t=>t.value===s))==null?void 0:h.short}).join(", ")} at ${l.value.time} (${l.value.timezone})`;case"monthly":return`Every month on day ${l.value.dayOfMonth} at ${l.value.time} (${l.value.timezone})`;case"cron":return l.value.cronExpression||"Enter cron expression";default:return""}});return(i,s)=>{var h;return a(),o("div",Ee,[e("div",Ce,[(a(!0),o(k,null,_(O.value,t=>(a(),o("div",{key:t,class:y(["flex items-center",{"flex-1":t<O.value}])},[e("div",{class:y(["w-10 h-10 rounded-full flex items-center justify-center font-semibold transition-all",f.value>=t?"bg-gradient-to-br from-blue-600 to-cyan-600 text-white shadow-lg shadow-blue-500/30":"bg-gray-100 text-gray-600 border border-gray-200"])},[f.value>t?(a(),re(b(g),{key:0,icon:"lucide:check",class:"w-5 h-5"})):(a(),o("span",Se,d(t),1))],2),t<O.value?(a(),o("div",{key:0,class:y(["h-1 flex-1 mx-2 transition-all rounded",f.value>t?"bg-gradient-to-r from-blue-600 to-cyan-600":"bg-gray-200"])},null,2)):m("",!0)],2))),128))]),f.value===1?(a(),o("div",Me,[s[14]||(s[14]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2 tracking-wide"},"Selecionar Fluxo"),e("p",{class:"text-sm text-gray-700 mb-4 tracking-wide"},"Escolha o fluxo que deseja agendar")],-1)),e("div",Ve,[(a(!0),o(k,null,_(I.availableFlows,t=>(a(),o("button",{key:N(t),onClick:v=>l.value.flowId=N(t),class:y(["p-4 rounded-lg border-2 text-left transition-all",l.value.flowId===N(t)?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"])},[e("div",Ie,[e("div",null,[e("div",Oe,d(t.name),1),e("div",Ue,d(t.description||"Sem descri√ß√£o"),1)]),l.value.flowId===N(t)?(a(),re(b(g),{key:0,icon:"lucide:check-circle",class:"w-6 h-6 text-blue-600"})):m("",!0)])],10,Te))),128))]),c.value.flowId?(a(),o("p",Fe,d(c.value.flowId),1)):m("",!0)])):m("",!0),f.value===2?(a(),o("div",ze,[s[30]||(s[30]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2 tracking-wide"},"Configurar Agendamento"),e("p",{class:"text-sm text-gray-700 mb-4 tracking-wide"},"Defina quando e com que frequ√™ncia este fluxo deve ser executado")],-1)),e("div",null,[s[15]||(s[15]=e("label",{class:"block text-sm font-medium text-gray-900 mb-3 tracking-wide"},"Tipo de Agendamento",-1)),e("div",Ae,[(a(),o(k,null,_(P,t=>e("button",{key:t.value,onClick:v=>l.value.scheduleType=t.value,class:y(["p-4 rounded-lg border-2 text-left transition-all",l.value.scheduleType===t.value?"border-blue-500 bg-blue-50":"border-gray-200 bg-white hover:border-gray-300 hover:bg-gray-50"])},[e("div",je,[x(b(g),{icon:t.icon,class:y(["w-6 h-6",l.value.scheduleType===t.value?"text-blue-600":"text-gray-400"])},null,8,["icon","class"]),e("div",null,[e("div",Pe,d(t.label),1),e("div",qe,d(t.description),1)])])],10,We)),64))])]),l.value.scheduleType==="interval"?(a(),o("div",He,[e("div",null,[s[16]||(s[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Valor do Intervalo",-1)),p(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>l.value.intervalValue=t),type:"number",min:"1",class:y(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-600":c.value.intervalValue}])},null,2),[[T,l.value.intervalValue,void 0,{number:!0}]]),c.value.intervalValue?(a(),o("p",Ye,d(c.value.intervalValue),1)):m("",!0)]),e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Unidade",-1)),p(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>l.value.intervalUnit=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},[(a(),o(k,null,_(te,t=>e("option",{key:t.value,value:t.value},d(t.label),9,Ne)),64))],512),[[B,l.value.intervalUnit]])])])):m("",!0),l.value.scheduleType==="daily"?(a(),o("div",Le,[e("div",null,[s[18]||(s[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Time",-1)),p(e("input",{"onUpdate:modelValue":s[2]||(s[2]=t=>l.value.time=t),type:"time",class:y(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-600":c.value.time}])},null,2),[[T,l.value.time]]),c.value.time?(a(),o("p",Re,d(c.value.time),1)):m("",!0)]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),p(e("select",{"onUpdate:modelValue":s[3]||(s[3]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},[(a(),o(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,Qe)),64))],512),[[B,l.value.timezone]])])])):m("",!0),l.value.scheduleType==="weekly"?(a(),o("div",Be,[e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Days of Week",-1)),e("div",Je,[(a(),o(k,null,_(U,t=>e("button",{key:t.value,onClick:ee(v=>G(t.value),["prevent"]),class:y(["px-4 py-2 rounded-lg border-2 transition-all",w(t.value)?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 text-gray-600 hover:border-gray-300"])},d(t.short),11,Xe)),64))]),c.value.daysOfWeek?(a(),o("p",Ge,d(c.value.daysOfWeek),1)):m("",!0)]),e("div",Ke,[e("div",null,[s[21]||(s[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Time",-1)),p(e("input",{"onUpdate:modelValue":s[4]||(s[4]=t=>l.value.time=t),type:"time",class:y(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-600":c.value.time}])},null,2),[[T,l.value.time]])]),e("div",null,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),p(e("select",{"onUpdate:modelValue":s[5]||(s[5]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},[(a(),o(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,Ze)),64))],512),[[B,l.value.timezone]])])])])):m("",!0),l.value.scheduleType==="monthly"?(a(),o("div",et,[e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Day of Month",-1)),p(e("input",{"onUpdate:modelValue":s[6]||(s[6]=t=>l.value.dayOfMonth=t),type:"number",min:"1",max:"31",class:y(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-600":c.value.dayOfMonth}])},null,2),[[T,l.value.dayOfMonth,void 0,{number:!0}]]),c.value.dayOfMonth?(a(),o("p",tt,d(c.value.dayOfMonth),1)):m("",!0)]),e("div",null,[s[24]||(s[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Time",-1)),p(e("input",{"onUpdate:modelValue":s[7]||(s[7]=t=>l.value.time=t),type:"time",class:y(["w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all",{"border-red-600":c.value.time}])},null,2),[[T,l.value.time]])]),e("div",null,[s[25]||(s[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),p(e("select",{"onUpdate:modelValue":s[8]||(s[8]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},[(a(),o(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,lt)),64))],512),[[B,l.value.timezone]])])])):m("",!0),l.value.scheduleType==="cron"?(a(),o("div",st,[e("div",null,[s[26]||(s[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Cron Expression",-1)),p(e("input",{"onUpdate:modelValue":s[9]||(s[9]=t=>l.value.cronExpression=t),type:"text",placeholder:"0 */2 * * *",class:y(["w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono",{"border-red-500":c.value.cronExpression}])},null,2),[[T,l.value.cronExpression]]),c.value.cronExpression?(a(),o("p",at,d(c.value.cronExpression),1)):m("",!0)]),e("div",null,[s[27]||(s[27]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Timezone",-1)),p(e("select",{"onUpdate:modelValue":s[10]||(s[10]=t=>l.value.timezone=t),class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},[(a(),o(k,null,_($,t=>e("option",{key:t,value:t},d(t),9,ot)),64))],512),[[B,l.value.timezone]])]),e("div",nt,[s[28]||(s[28]=e("p",{class:"text-sm font-medium text-blue-900 mb-2"},"Common Examples:",-1)),e("div",rt,[(a(),o(k,null,_(q,t=>e("div",{key:t.expr,class:"flex items-center justify-between text-sm"},[e("code",it,d(t.expr),1),e("span",ut,d(t.desc),1)])),64))])])])):m("",!0),e("div",dt,[e("div",ct,[x(b(g),{icon:"lucide:info",class:"w-4 h-4 text-gray-600"}),s[29]||(s[29]=e("span",{class:"text-sm font-medium text-gray-700"},"Schedule Preview:",-1)),e("span",mt,d(K.value),1)])])])):m("",!0),f.value===3&&I.flowInputs.length>0?(a(),o("div",vt,[s[33]||(s[33]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Flow Input Data"),e("p",{class:"text-sm text-gray-600 mb-4"},"Provide data that will be used in each execution")],-1)),e("div",bt,[(a(!0),o(k,null,_(I.flowInputs,t=>(a(),o("div",{key:t.name,class:"space-y-2"},[e("label",xt,[e("div",gt,[e("span",ft,[Z(d(t.name)+" ",1),t.required?(a(),o("span",yt,"*")):m("",!0)]),e("span",pt,d(t.type),1)]),R(t)?(a(),o("div",wt,[p(e("textarea",{"onUpdate:modelValue":v=>l.value.inputData[t.name]=v,rows:"2",placeholder:"{{today}} or {{today - 7 days}}",required:t.required,class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono text-sm"},null,8,ht),[[T,l.value.inputData[t.name]]]),e("div",kt,[s[31]||(s[31]=e("p",{class:"text-xs font-medium text-blue-900 mb-2"},"üí° Quick Insert:",-1)),e("div",_t,[(a(),o(k,null,_(S,v=>e("button",{key:v.value,onClick:ee(Q=>se(t.name,v.value),["prevent"]),type:"button",class:"text-xs bg-white hover:bg-blue-100 px-2 py-1 rounded border border-blue-300 transition-colors"},d(v.label),9,$t)),64))]),e("p",Dt," Format: "+d(t.dateFormat||"YYYY-MM-DD"),1)]),z(l.value.inputData[t.name])?(a(),o("div",Et,[e("p",Ct,[s[32]||(s[32]=Z(" üìÖ Preview: ",-1)),e("span",St,d(le(l.value.inputData[t.name],t.dateFormat)),1)])])):m("",!0)])):t.type!=="boolean"?p((a(),o("input",{key:1,"onUpdate:modelValue":v=>l.value.inputData[t.name]=v,type:F(t.type),required:t.required,placeholder:t.defaultValue!==void 0?String(t.defaultValue):"",class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},null,8,Mt)),[[xe,l.value.inputData[t.name]]]):(a(),o("div",Vt,[p(e("input",{"onUpdate:modelValue":v=>l.value.inputData[t.name]=v,type:"checkbox",id:`wizard-input-${t.name}`,class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"},null,8,Tt),[[ge,l.value.inputData[t.name]]]),e("label",{for:`wizard-input-${t.name}`,class:"ml-2 text-sm text-gray-700"},d(t.description||"Enable"),9,It)])),t.description&&t.type!=="boolean"&&!R(t)?(a(),o("p",Ot,d(t.description),1)):m("",!0),t.nodeName?(a(),o("p",Ut,[x(b(g),{icon:"lucide:box",class:"w-3 h-3 inline mr-1"}),Z(" From: "+d(t.nodeName),1)])):m("",!0)])]))),128))])])):m("",!0),f.value===(I.flowInputs.length>0?4:3)?(a(),o("div",Ft,[s[39]||(s[39]=e("div",null,[e("h3",{class:"text-lg font-semibold text-gray-900 mb-2"},"Review & Advanced Options"),e("p",{class:"text-sm text-gray-600 mb-4"},"Review your schedule and configure optional settings")],-1)),e("div",zt,[e("div",At,[x(b(g),{icon:"lucide:workflow",class:"w-5 h-5"}),e("span",Wt,d((h=ae.value)==null?void 0:h.name),1)]),e("div",jt,[x(b(g),{icon:"lucide:clock",class:"w-4 h-4"}),e("span",Pt,d(K.value),1)]),Object.keys(l.value.inputData).length>0?(a(),o("div",qt,[x(b(g),{icon:"lucide:input",class:"w-4 h-4"}),e("span",Ht,d(Object.keys(l.value.inputData).length)+" input(s) configured",1)])):m("",!0)]),e("div",Yt,[s[38]||(s[38]=e("h4",{class:"text-sm font-medium text-gray-700 mb-4"},"Advanced Options (Optional)",-1)),e("div",Nt,[e("div",null,[s[34]||(s[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Max Executions",-1)),p(e("input",{"onUpdate:modelValue":s[11]||(s[11]=t=>l.value.maxExecutions=t),type:"number",min:"1",placeholder:"Unlimited",class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},null,512),[[T,l.value.maxExecutions,void 0,{number:!0}]]),s[35]||(s[35]=e("p",{class:"text-xs text-gray-600 mt-1"},"Leave empty for unlimited executions",-1))]),e("div",null,[s[36]||(s[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Expires At",-1)),p(e("input",{"onUpdate:modelValue":s[12]||(s[12]=t=>l.value.expiresAt=t),type:"datetime-local",class:"w-full px-3 py-2 border border-gray-300 bg-white rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"},null,512),[[T,l.value.expiresAt]]),s[37]||(s[37]=e("p",{class:"text-xs text-gray-600 mt-1"},"Schedule will stop after this date",-1))])])])])):m("",!0),e("div",Lt,[f.value>1?(a(),o("button",{key:0,onClick:M,type:"button",class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg bg-white hover:bg-gray-50 transition-all flex items-center space-x-2 font-medium"},[x(b(g),{icon:"lucide:arrow-left",class:"w-4 h-4"}),s[40]||(s[40]=e("span",null,"Voltar",-1))])):(a(),o("button",{key:1,onClick:s[13]||(s[13]=t=>i.$emit("cancel")),type:"button",class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg bg-white hover:bg-gray-50 transition-all font-medium"}," Cancelar ")),f.value<O.value?(a(),o("button",{key:2,onClick:Y,type:"button",class:"px-4 py-2.5 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-lg transition-all flex items-center space-x-2 shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 font-medium"},[s[41]||(s[41]=e("span",null,"Pr√≥ximo",-1)),x(b(g),{icon:"lucide:arrow-right",class:"w-4 h-4"})])):(a(),o("button",{key:3,onClick:X,type:"button",class:"px-4 py-2.5 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-lg transition-all flex items-center space-x-2 shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 font-medium"},[x(b(g),{icon:"lucide:check",class:"w-4 h-4"}),s[42]||(s[42]=e("span",null,"Criar Agendamento",-1))]))])])}}},Qt={class:"mb-8"},Bt={class:"flex items-center justify-between"},Jt={class:"mb-6"},Xt={class:"max-w-md"},Gt=["value"],Kt={key:0,class:"flex justify-center py-12"},Zt={key:1,class:"text-center py-12 glass-card backdrop-blur-xl bg-white/70 rounded-xl border border-white/40 shadow-sm"},el={key:2},tl={class:"space-y-4"},ll={class:"flex items-start justify-between"},sl={class:"flex-1"},al={class:"flex items-center space-x-3 mb-2"},ol={class:"text-lg font-semibold text-gray-900"},nl={class:"text-sm text-gray-600 mb-3"},rl={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-3"},il={class:"flex items-center text-sm"},ul={class:"font-medium text-gray-900"},dl={key:0,class:"text-xs text-blue-600"},cl={class:"flex items-center text-sm"},ml={class:"font-medium text-gray-900"},vl={key:0,class:"flex items-center text-sm"},bl={class:"font-medium text-red-600"},xl={key:0,class:"bg-orange-500/10 border border-orange-500/30 rounded-lg p-3 mb-3 backdrop-blur-sm"},gl={class:"flex items-start"},fl={class:"text-sm text-orange-600"},yl={class:"flex items-center space-x-4 text-xs text-gray-600 tracking-wide"},pl={key:0},wl={key:1},hl={class:"flex items-center space-x-2 ml-4"},kl=["onClick","title"],_l=["onClick"],$l=["onClick"],Dl={key:0,class:"mt-6 flex items-center justify-between glass-card backdrop-blur-xl bg-white/70 rounded-xl border border-white/40 shadow-sm p-4"},El={class:"text-sm text-gray-700 tracking-wide"},Cl={class:"flex items-center space-x-2"},Sl=["disabled"],Ml={class:"flex items-center space-x-1"},Vl=["onClick"],Tl=["disabled"],Il={class:"sticky top-0 bg-white/80 backdrop-blur-xl border-b border-gray-200/50 px-6 py-4 flex items-center justify-between"},Ol={class:"p-6"},Ul={class:"flex items-center mb-4"},Fl={class:"flex space-x-3"},zl={__name:"SchedulesView",setup(I){const J=he(),{schedules:D,loading:L,getSchedules:f,deleteSchedule:O,enableSchedule:l,disableSchedule:c}=ce(),$=$e(),{getFlowInputs:U,getFlowOptions:te,flowOptions:P}=$,S=E(!1),q=E(!1),H=E(null),Y=E([]),M=E(""),X=E([]),G=E(!1),w=E(1),F=E(4);fe(()=>W(null,null,function*(){yield z(),yield le(),R(),window.addEventListener("resize",R)})),ye(()=>{window.removeEventListener("resize",R)});function R(){const r=window.innerHeight-376,V=Math.floor(r/280);F.value=Math.max(2,Math.min(6,V))}function z(){return W(this,null,function*(){const u={};M.value&&(u.flowId=M.value),yield f(u)})}function le(){return W(this,null,function*(){try{const u=yield te();u.success?Y.value=u.data.flows||P.value||[]:P.value&&(Y.value=P.value)}catch(u){P.value&&(Y.value=P.value)}})}function se(u){return W(this,null,function*(){var r;G.value=!0;const n=yield U(u);G.value=!1,n.success?X.value=((r=n.data.data)==null?void 0:r.inputs)||[]:X.value=[]})}function N(u){return W(this,null,function*(){const{createSchedule:n}=ce();(yield n(u)).success&&(S.value=!1,yield z())})}function ae(u){return W(this,null,function*(){u.enabled?yield c(u._id):yield l(u._id),yield z()})}function K(u){H.value=u,q.value=!0}function i(){return W(this,null,function*(){if(!H.value)return;(yield O(H.value._id)).success&&(q.value=!1,H.value=null,yield z())})}function s(u){J.push(`/executions?scheduleId=${u._id}`)}function h(u){return new Date(u).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function t(u){switch(u.scheduleType){case"interval":return`Every ${u.intervalValue} ${u.intervalUnit}`;case"daily":return`Daily at ${u.time} (${u.timezone})`;case"weekly":const n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return`${u.daysOfWeek.map(C=>n[C]).join(", ")} at ${u.time} (${u.timezone})`;case"monthly":return`Monthly on day ${u.dayOfMonth} at ${u.time} (${u.timezone})`;case"cron":return`Cron: ${u.cronExpression} (${u.timezone})`;default:return"Unknown schedule type"}}function v(u){if(!u)return null;const n=new Date,C=new Date(u)-n;if(C<0)return"Overdue";const V=Math.floor(C/(1e3*60*60)),ue=Math.floor(C%(1e3*60*60)/(1e3*60));if(V>24){const de=Math.floor(V/24);return`in ${de} day${de>1?"s":""}`}else return V>0?`in ${V}h ${ue}m`:`in ${ue}m`}const Q=j(()=>{let u=D.value;return M.value&&(u=u.filter(n=>n.flowId._id===M.value)),u}),oe=j(()=>{const u=(w.value-1)*F.value,n=u+F.value;return Q.value.slice(u,n)}),A=j(()=>Math.ceil(Q.value.length/F.value)),ne=j(()=>D.value.length>0),ie=j(()=>Q.value.length);function me(u){u>=1&&u<=A.value&&(w.value=u)}function ve(){w.value<A.value&&w.value++}function be(){w.value>1&&w.value--}return pe(M,()=>{w.value=1}),(u,n)=>(a(),re(ke,null,{default:we(()=>[e("div",Qt,[e("div",Bt,[n[11]||(n[11]=e("div",null,[e("h1",{class:"text-3xl font-semibold text-gray-800 tracking-wide"},"Agendamentos"),e("p",{class:"text-gray-600 mt-2 text-sm tracking-wide"},"Automatize seus fluxos com execu√ß√µes agendadas")],-1)),e("button",{onClick:n[0]||(n[0]=r=>S.value=!0),class:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-5 py-2.5 rounded-lg flex items-center space-x-2 transition-all shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 text-sm font-medium tracking-wide"},[x(b(g),{icon:"lucide:plus",class:"w-4 h-4"}),n[10]||(n[10]=e("span",null,"Criar Agendamento",-1))])])]),e("div",Jt,[e("div",Xt,[n[13]||(n[13]=e("label",{class:"block text-xs font-medium text-gray-600 mb-2 uppercase tracking-wider"},"Filtrar por Fluxo",-1)),p(e("select",{"onUpdate:modelValue":n[1]||(n[1]=r=>M.value=r),onChange:z,class:"w-full px-3 py-2.5 bg-white/50 backdrop-blur-sm border border-gray-300 rounded-lg text-gray-900 focus:outline-none focus:border-blue-500 focus:bg-white/70 transition-all text-sm"},[n[12]||(n[12]=e("option",{value:""},"Todos os Fluxos",-1)),(a(!0),o(k,null,_(Y.value,r=>(a(),o("option",{key:r.id||r._id,value:r.id||r._id},d(r.name),9,Gt))),128))],544),[[B,M.value]])])]),b(L)?(a(),o("div",Kt,[x(b(g),{icon:"lucide:loader-2",class:"w-8 h-8 animate-spin text-blue-600"})])):ne.value?(a(),o("div",el,[e("div",tl,[(a(!0),o(k,null,_(oe.value,r=>{var C;return a(),o("div",{key:r._id,class:"glass-card backdrop-blur-xl bg-white/70 rounded-xl border border-white/40 shadow-sm p-6 hover:shadow-xl hover:bg-white/80 transition-all"},[e("div",ll,[e("div",sl,[e("div",al,[e("h3",ol,d(((C=r.flowId)==null?void 0:C.name)||"Unknown Flow"),1),x(_e,{enabled:r.enabled,"is-currently-running":r.isCurrentlyRunning,"paused-reason":r.pausedReason},null,8,["enabled","is-currently-running","paused-reason"])]),e("p",nl,d(t(r)),1),e("div",rl,[e("div",il,[x(b(g),{icon:"lucide:calendar-clock",class:"w-4 h-4 text-blue-600 mr-2"}),e("div",null,[n[17]||(n[17]=e("div",{class:"text-gray-600 text-xs"},"Pr√≥xima execu√ß√£o:",-1)),e("div",ul,d(r.nextExecutionAt?h(r.nextExecutionAt):"N/A"),1),r.enabled&&r.nextExecutionAt?(a(),o("div",dl,d(v(r.nextExecutionAt)),1)):m("",!0)])]),e("div",cl,[x(b(g),{icon:"lucide:activity",class:"w-4 h-4 text-green-600 mr-2"}),e("div",null,[n[18]||(n[18]=e("div",{class:"text-gray-600 text-xs"},"Total de execu√ß√µes:",-1)),e("div",ml,d(r.executionCount||0),1),r.lastExecutionStatus?(a(),o("div",{key:0,class:y(["text-xs",r.lastExecutionStatus==="success"?"text-green-600":"text-red-600"])}," √öltima: "+d(r.lastExecutionStatus==="success"?"sucesso":"falhou"),3)):m("",!0)])]),r.consecutiveFailures>0?(a(),o("div",vl,[x(b(g),{icon:"lucide:alert-triangle",class:"w-4 h-4 text-red-600 mr-2"}),e("div",null,[n[19]||(n[19]=e("div",{class:"text-gray-600 text-xs"},"Falhas consecutivas:",-1)),e("div",bl,d(r.consecutiveFailures),1)])])):m("",!0)]),r.pausedReason?(a(),o("div",xl,[e("div",gl,[x(b(g),{icon:"lucide:alert-circle",class:"w-4 h-4 text-orange-600 mr-2 mt-0.5"}),e("div",fl,[n[20]||(n[20]=e("strong",null,"Pausado:",-1)),Z(" "+d(r.pausedReason),1)])])])):m("",!0),e("div",yl,[e("span",null,"Criado "+d(h(r.createdAt)),1),r.maxExecutions?(a(),o("span",pl," M√°x execu√ß√µes: "+d(r.maxExecutions),1)):m("",!0),r.expiresAt?(a(),o("span",wl," Expira: "+d(h(r.expiresAt)),1)):m("",!0)])]),e("div",hl,[e("button",{onClick:V=>ae(r),title:r.enabled?"Desabilitar":"Habilitar",class:y(["p-2 rounded-lg transition-all",r.enabled?"text-orange-600 hover:bg-orange-50":"text-green-600 hover:bg-green-50"])},[x(b(g),{icon:r.enabled?"lucide:pause-circle":"lucide:play-circle",class:"w-5 h-5"},null,8,["icon"])],10,kl),e("button",{onClick:V=>s(r),title:"Ver Execu√ß√µes",class:"p-2 text-blue-600 hover:bg-blue-50 rounded-lg transition-all"},[x(b(g),{icon:"lucide:history",class:"w-5 h-5"})],8,_l),e("button",{onClick:V=>K(r),title:"Excluir",class:"p-2 text-red-600 hover:bg-red-50 rounded-lg transition-all"},[x(b(g),{icon:"lucide:trash-2",class:"w-5 h-5"})],8,$l)])])])}),128))]),A.value>1?(a(),o("div",Dl,[e("div",El," Mostrando "+d((w.value-1)*F.value+1)+"-"+d(Math.min(w.value*F.value,ie.value))+" de "+d(ie.value),1),e("div",Cl,[e("button",{onClick:be,disabled:w.value===1,class:y(["px-3 py-2 rounded-lg transition-all text-sm font-medium tracking-wide",w.value===1?"text-gray-400 cursor-not-allowed":"text-blue-600 hover:bg-blue-50"])},[x(b(g),{icon:"lucide:chevron-left",class:"w-4 h-4"})],10,Sl),e("div",Ml,[(a(!0),o(k,null,_(A.value,r=>(a(),o("button",{key:r,onClick:C=>me(r),class:y(["px-3 py-1.5 rounded-lg text-sm font-medium tracking-wide transition-all",r===w.value?"bg-gradient-to-r from-blue-600 to-cyan-600 text-white shadow-lg shadow-blue-500/30":"text-gray-700 hover:bg-white/60"])},d(r),11,Vl))),128))]),e("button",{onClick:ve,disabled:w.value===A.value,class:y(["px-3 py-2 rounded-lg transition-all text-sm font-medium tracking-wide",w.value===A.value?"text-gray-400 cursor-not-allowed":"text-blue-600 hover:bg-blue-50"])},[x(b(g),{icon:"lucide:chevron-right",class:"w-4 h-4"})],10,Tl)])])):m("",!0)])):(a(),o("div",Zt,[x(b(g),{icon:"lucide:clock",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),n[15]||(n[15]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum agendamento ainda",-1)),n[16]||(n[16]=e("p",{class:"text-gray-600 mb-6 text-sm tracking-wide"},"Crie seu primeiro agendamento para automatizar a execu√ß√£o de fluxos",-1)),e("button",{onClick:n[2]||(n[2]=r=>S.value=!0),class:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-5 py-2.5 rounded-lg transition-all inline-flex items-center space-x-2 shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 text-sm font-medium tracking-wide"},[x(b(g),{icon:"lucide:plus",class:"w-4 h-4"}),n[14]||(n[14]=e("span",null,"Criar Primeiro Agendamento",-1))])])),S.value?(a(),o("div",{key:3,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:n[6]||(n[6]=r=>S.value=!1)},[e("div",{class:"glass-card backdrop-blur-xl bg-white/90 rounded-xl border border-white/40 shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:n[5]||(n[5]=ee(()=>{},["stop"]))},[e("div",Il,[n[21]||(n[21]=e("h2",{class:"text-xl font-semibold text-gray-900 tracking-wide"},"Criar Agendamento",-1)),e("button",{onClick:n[3]||(n[3]=r=>S.value=!1),class:"text-gray-500 hover:text-gray-700 hover:bg-gray-100/50 p-1.5 rounded-lg transition-all"},[x(b(g),{icon:"lucide:x",class:"w-6 h-6"})])]),e("div",Ol,[x(Rt,{"available-flows":Y.value,"flow-inputs":X.value,onFlowSelected:se,onSubmit:N,onCancel:n[4]||(n[4]=r=>S.value=!1)},null,8,["available-flows","flow-inputs"])])])])):m("",!0),q.value?(a(),o("div",{key:4,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:n[9]||(n[9]=r=>q.value=!1)},[e("div",{class:"glass-card backdrop-blur-xl bg-white/70 rounded-lg border border-white/40 shadow-xl p-6 max-w-sm w-full mx-4",onClick:n[8]||(n[8]=ee(()=>{},["stop"]))},[e("div",Ul,[x(b(g),{icon:"lucide:alert-triangle",class:"w-6 h-6 text-red-600 mr-3"}),n[22]||(n[22]=e("h3",{class:"text-lg font-semibold text-gray-900 tracking-wide"},"Excluir Agendamento",-1))]),n[23]||(n[23]=e("p",{class:"text-gray-700 mb-6 text-sm tracking-wide"}," Tem certeza que deseja excluir este agendamento? Esta a√ß√£o n√£o pode ser desfeita. ",-1)),e("div",Fl,[e("button",{onClick:n[7]||(n[7]=r=>q.value=!1),class:"flex-1 px-4 py-2.5 bg-white/70 backdrop-blur-sm border border-gray-300 text-gray-700 rounded-lg hover:bg-white/90 hover:brightness-95 transition-all text-sm font-medium tracking-wide"}," Cancelar "),e("button",{onClick:i,class:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all text-sm font-medium tracking-wide shadow-lg shadow-red-500/30"}," Excluir ")])])])):m("",!0)]),_:1}))}},Ll=De(zl,[["__scopeId","data-v-02cccb41"]]);export{Ll as default};
