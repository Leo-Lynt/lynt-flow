var n=(u,i,g)=>new Promise((S,T)=>{var w=f=>{try{E(g.next(f))}catch(v){T(v)}},p=f=>{try{E(g.throw(f))}catch(v){T(v)}},E=f=>f.done?S(f.value):Promise.resolve(f.value).then(w,p);E((g=g.apply(u,i)).next())});import{c as z,r as R,A as Y}from"./vue-vendor-BR4PrzJp.js";import{a as q}from"./utils-nSMfNdYQ.js";const _="http://localhost:3001/api",c=q.create({baseURL:_,timeout:1e4});c.interceptors.request.use(u=>{const i=localStorage.getItem("accessToken");return i&&(u.headers.Authorization=`Bearer ${i}`),u},u=>Promise.reject(u));c.interceptors.response.use(u=>u,u=>n(null,null,function*(){var T;const i=u.config;if(["/auth/login","/auth/register","/auth/2fa/login","/auth/refresh"].some(w=>{var p;return(p=i.url)==null?void 0:p.includes(w)}))return Promise.reject(u);if(((T=u.response)==null?void 0:T.status)===401&&!i._retry){i._retry=!0;const w=localStorage.getItem("refreshToken");if(w)try{const p=yield q.post(`${_}/auth/refresh`,{refreshToken:w}),{data:E}=p.data,{tokens:f}=E,{accessToken:v,refreshToken:D}=f;return localStorage.setItem("accessToken",v),localStorage.setItem("refreshToken",D),i.headers.Authorization=`Bearer ${v}`,c(i)}catch(p){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(p)}else localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login"}return Promise.reject(u)}));const h=R(null),F=R(localStorage.getItem("accessToken")),j=R(localStorage.getItem("refreshToken")),t=R(!1);let I=null;function re(){const u=Y(),i=z(()=>!!F.value);function g(r,s){F.value=r,j.value=s,localStorage.setItem("accessToken",r),localStorage.setItem("refreshToken",s)}function S(){h.value=null,F.value=null,j.value=null,localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")}function T(r,s,e=null){return n(this,null,function*(){var a,o,y,A;try{t.value=!0;const d=yield c.post("/auth/login",{email:r,password:s}),{data:l}=d.data;if(l.requires2FA)return{success:!0,requires2FA:!0,tempToken:l.tempToken};const{user:m,tokens:k}=l,{accessToken:P,refreshToken:b}=k;if(h.value=m,g(P,b),e){const $=e.includes("?")?"&":"?";window.location.href=`${e}${$}authToken=${P}&refreshToken=${b}`}else u.push("/dashboard");return{success:!0}}catch(d){const l=((o=(a=d.response)==null?void 0:a.data)==null?void 0:o.error)||{},m=((A=(y=d.response)==null?void 0:y.data)==null?void 0:A.message)||l.message||"Erro ao fazer login",k=l.data||null;return{success:!1,error:m,attemptsInfo:k}}finally{t.value=!1}})}function w(r,s,e=null){return n(this,null,function*(){var a,o,y,A;try{t.value=!0;const d=yield c.post("/auth/2fa/login",{tempToken:r,token:s}),{data:l}=d.data,{user:m,tokens:k}=l,{accessToken:P,refreshToken:b}=k;if(h.value=m,g(P,b),yield new Promise($=>setTimeout($,50)),e){const $=e.includes("?")?"&":"?";window.location.href=`${e}${$}authToken=${P}&refreshToken=${b}`}else window.location.href="/dashboard";return{success:!0}}catch(d){const l=((o=(a=d.response)==null?void 0:a.data)==null?void 0:o.error)||{},m=((A=(y=d.response)==null?void 0:y.data)==null?void 0:A.message)||l.message||"Código inválido ou expirado",k=l.data||null;return{success:!1,error:m,attemptsInfo:k}}finally{t.value=!1}})}function p(r,s,e){return n(this,null,function*(){var a,o;try{t.value=!0;const y=yield c.post("/auth/register",{name:r,email:s,password:e}),{data:A}=y.data,{user:d,tokens:l}=A,{accessToken:m,refreshToken:k}=l;return h.value=d,g(m,k),u.push("/dashboard"),{success:!0}}catch(y){return{success:!1,error:((o=(a=y.response)==null?void 0:a.data)==null?void 0:o.message)||"Erro ao criar conta"}}finally{t.value=!1}})}function E(){return n(this,null,function*(){var r,s;try{t.value=!0;const e=yield c.get("/auth/google/login"),{data:a}=e.data,o=a.authUrl;return window.location.href=o,{success:!0}}catch(e){return t.value=!1,{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao iniciar login com Google"}}})}function f(){return n(this,null,function*(){S(),u.push("/login")})}function v(r=!1){return n(this,null,function*(){return!r&&h.value?{success:!0,data:h.value}:(!r&&I||(r&&(I=null),I=n(null,null,function*(){var s,e;try{t.value=!0;const a=yield c.get("/auth/profile"),o=a.data.data||a.data;return h.value=o,{success:!0,data:o}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao buscar perfil"}}finally{t.value=!1,I=null}})),I)})}function D(r){return n(this,null,function*(){var s,e;try{t.value=!0;const a=yield c.put("/auth/profile",r),o=a.data.data||a.data;return h.value=o,{success:!0,data:o}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao atualizar perfil"}}finally{t.value=!1}})}function x(r,s){return n(this,null,function*(){var e,a;try{return t.value=!0,yield c.put("/auth/change-password",{currentPassword:r,newPassword:s}),{success:!0}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao alterar senha"}}finally{t.value=!1}})}function B(){return n(this,null,function*(){var r,s;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/send-verification")).data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao enviar email de verificação"}}finally{t.value=!1}})}function L(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/verify-email",{token:r})).data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao verificar email"}}finally{t.value=!1}})}function C(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/forgot-password",{email:r})).data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao solicitar reset de senha"}}finally{t.value=!1}})}function G(r,s){return n(this,null,function*(){var e,a;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/reset-password",{token:r,newPassword:s})).data}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao redefinir senha"}}finally{t.value=!1}})}function M(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/preferences")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter preferências"}}})}function V(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.put("/auth/preferences",r)).data.data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao atualizar preferências"}}finally{t.value=!1}})}function W(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/profile/stats")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter estatísticas"}}})}function H(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/sessions")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter sessões"}}})}function J(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.delete(`/auth/sessions/${r}`)).data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao revogar sessão"}}finally{t.value=!1}})}function K(){return n(this,null,function*(){var r,s;try{return t.value=!0,{success:!0,data:(yield c.delete("/auth/sessions/all",{data:{refreshToken:j.value}})).data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao revogar todas as sessões"}}finally{t.value=!1}})}function N(){return n(this,null,function*(){var r,s;try{return{success:!0,data:(yield c.get("/auth/connected-accounts")).data.data}}catch(e){return{success:!1,error:((s=(r=e.response)==null?void 0:r.data)==null?void 0:s.message)||"Erro ao obter contas conectadas"}}})}function O(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/2fa/enable",{password:r})).data.data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao ativar 2FA"}}finally{t.value=!1}})}function Q(r){return n(this,null,function*(){var s,e;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/2fa/verify",{token:r})).data.data}}catch(a){return{success:!1,error:((e=(s=a.response)==null?void 0:s.data)==null?void 0:e.message)||"Erro ao verificar 2FA"}}finally{t.value=!1}})}function U(r,s){return n(this,null,function*(){var e,a;try{return t.value=!0,{success:!0,data:(yield c.post("/auth/2fa/disable",{password:r,token:s})).data}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao desativar 2FA"}}finally{t.value=!1}})}function X(r,s){return n(this,null,function*(){var e,a;try{t.value=!0;const o=yield c.delete("/auth/account",{data:{password:r,confirmation:s}});return S(),u.push("/login"),{success:!0,data:o.data}}catch(o){return{success:!1,error:((a=(e=o.response)==null?void 0:e.data)==null?void 0:a.message)||"Erro ao deletar conta"}}finally{t.value=!1}})}return F.value&&!h.value&&v(),{user:z(()=>h.value),isAuthenticated:i,loading:z(()=>t.value),login:T,verify2FALogin:w,register:p,loginWithGoogle:E,logout:f,getProfile:v,updateProfile:D,changePassword:x,sendVerificationEmail:B,verifyEmail:L,forgotPassword:C,resetPassword:G,getPreferences:M,updatePreferences:V,getProfileStats:W,getActiveSessions:H,revokeSession:J,revokeAllSessions:K,getConnectedAccounts:N,enable2FA:O,verify2FA:Q,disable2FA:U,deleteAccount:X}}export{c as a,re as u};
