var F=(p,_,v)=>new Promise((C,m)=>{var y=c=>{try{w(v.next(c))}catch(a){m(a)}},D=c=>{try{w(v.throw(c))}catch(a){m(a)}},w=c=>c.done?C(c.value):Promise.resolve(c.value).then(y,D);w((v=v.apply(p,_)).next())});import{r as h,w as Q,i as u,m as k,b as d,k as t,l as i,u as n,I as r,t as f,F as W,C as J,q as U,z as V,y as ne,E as ie,n as z,p as A,c as re,o as de,G as ce,a as H,s as ue,A as xe,v as me,H as ge}from"./vue-vendor-BR4PrzJp.js";import{_ as pe}from"./AppLayout-SClu9rSN.js";import{u as be}from"./useFlows-ZtHeo4Pl.js";import{u as fe}from"./useAuth-L5NC1uLI.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-nSMfNdYQ.js";const he={class:"flex items-center justify-between p-6 border-b border-gray-200"},ye={class:"flex items-center space-x-3"},we={class:"text-sm text-gray-600"},ke=["disabled"],_e={class:"flex-1 overflow-y-auto p-6"},Ce={key:0,class:"text-center py-8"},$e={key:1,class:"space-y-4"},Ee={class:"block"},Fe={class:"flex items-center justify-between mb-1"},De={class:"text-sm font-medium text-gray-700"},Le={key:0,class:"text-red-500"},Ve={class:"text-xs text-gray-500"},Ie=["onUpdate:modelValue","type","required","placeholder"],je={key:1,class:"flex items-center"},Ne=["onUpdate:modelValue","id"],Me=["for"],qe={key:2,class:"text-xs text-gray-500 mt-1"},Se={key:3,class:"text-xs text-gray-400 mt-1"},Te={class:"flex items-center justify-end space-x-3 p-6 border-t border-gray-200"},Be=["disabled"],Ue=["disabled"],ze={__name:"FlowExecutionModal",props:{show:{type:Boolean,default:!1},flowName:{type:String,required:!0},inputs:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["close","execute"],setup(p,{emit:_}){const v=p,C=_,m=h({});Q(()=>v.inputs,c=>{if(c&&c.length>0){const a={};c.forEach(o=>{a[o.name]=o.defaultValue!==void 0?o.defaultValue:""}),m.value=a}},{immediate:!0});function y(){v.loading||C("close")}function D(){const c=v.inputs.filter(a=>a.required&&!m.value[a.name]).map(a=>a.name);if(c.length>0){alert(`Por favor, preencha os campos obrigatórios: ${c.join(", ")}`);return}C("execute",m.value)}function w(c){return{string:"text",number:"number",boolean:"checkbox",email:"email",url:"url"}[c]||"text"}return(c,a)=>p.show?(d(),u("div",{key:0,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",onClick:y},[t("div",{class:"bg-white rounded-lg shadow-2xl max-w-2xl w-full max-h-[90vh] flex flex-col",onClick:a[0]||(a[0]=A(()=>{},["stop"]))},[t("div",he,[t("div",ye,[i(n(r),{icon:"lucide:play-circle",class:"w-6 h-6 text-brand-purple"}),t("div",null,[a[1]||(a[1]=t("h3",{class:"text-lg font-semibold text-gray-900 tracking-wide"},"Executar Fluxo",-1)),t("p",we,f(p.flowName),1)])]),t("button",{onClick:y,disabled:p.loading,class:"text-gray-500 hover:text-gray-700 hover:bg-gray-100 p-1 rounded transition-all disabled:opacity-50"},[i(n(r),{icon:"lucide:x",class:"w-5 h-5"})],8,ke)]),t("div",_e,[p.inputs.length===0?(d(),u("div",Ce,[i(n(r),{icon:"lucide:info",class:"w-12 h-12 text-gray-400 mx-auto mb-3"}),a[2]||(a[2]=t("p",{class:"text-gray-600 tracking-wide"},"Este fluxo não requer entradas",-1))])):(d(),u("div",$e,[(d(!0),u(W,null,J(p.inputs,o=>(d(),u("div",{key:o.name,class:"space-y-2"},[t("label",Ee,[t("div",Fe,[t("span",De,[V(f(o.name)+" ",1),o.required?(d(),u("span",Le,"*")):k("",!0)]),t("span",Ve,f(o.type),1)]),o.type!=="boolean"?U((d(),u("input",{key:0,"onUpdate:modelValue":b=>m.value[o.name]=b,type:w(o.type),required:o.required,placeholder:o.defaultValue!==void 0?String(o.defaultValue):"",class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-brand-purple focus:border-transparent focus:border-transparent"},null,8,Ie)),[[ne,m.value[o.name]]]):(d(),u("div",je,[U(t("input",{"onUpdate:modelValue":b=>m.value[o.name]=b,type:"checkbox",id:`input-${o.name}`,class:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-brand-purple focus:border-transparent"},null,8,Ne),[[ie,m.value[o.name]]]),t("label",{for:`input-${o.name}`,class:"ml-2 text-sm text-gray-700"},f(o.description||"Enable"),9,Me)])),o.description&&o.type!=="boolean"?(d(),u("p",qe,f(o.description),1)):k("",!0),o.nodeName?(d(),u("p",Se,[i(n(r),{icon:"lucide:box",class:"w-3 h-3 inline mr-1"}),V(" From: "+f(o.nodeName),1)])):k("",!0)])]))),128))]))]),t("div",Te,[t("button",{onClick:y,disabled:p.loading,class:"px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-all disabled:opacity-50 font-medium tracking-wide"}," Cancelar ",8,Be),t("button",{onClick:D,disabled:p.loading,class:"px-4 py-2 bg-brand-purple text-white rounded-lg hover:brightness-110 transition-all disabled:opacity-50 flex items-center space-x-2 font-medium tracking-wide"},[i(n(r),{icon:p.loading?"lucide:loader-2":"lucide:play",class:z(["w-4 h-4",{"animate-spin":p.loading}])},null,8,["icon","class"]),t("span",null,f(p.loading?"Executando...":"Executar Fluxo"),1)],8,Ue)])])])):k("",!0)}},Ae={class:"mb-8"},Pe={class:"flex items-center justify-between"},Oe={class:"mb-6"},Re={class:"relative max-w-md"},Ge={class:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"},He={key:0,class:"flex justify-center py-12"},Qe={key:1,class:"text-center py-12 glass-card backdrop-blur-xl bg-white/30 rounded-lg border border-white/20"},We={key:2,class:"text-center py-12 glass-card backdrop-blur-xl bg-white/30 rounded-lg border border-white/20"},Je={key:3,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},Ke={class:"relative p-5 space-y-4"},Xe={class:"flex items-start justify-between gap-3"},Ye={class:"text-base font-semibold text-gray-900 tracking-wide flex-1"},Ze={class:"text-xs text-gray-600 line-clamp-2 min-h-[2.5rem] tracking-wide leading-relaxed"},et={class:"flex items-center gap-4 text-xs text-gray-600"},tt={class:"flex items-center gap-1.5"},st={class:"flex items-center gap-1.5"},ot={class:"flex items-center gap-1.5 text-xs text-gray-500"},lt={class:"flex items-center gap-2 pt-2 border-t border-gray-200/50"},at=["onClick","disabled"],nt=["onClick"],it={class:"relative"},rt=["onClick"],dt=["onClick"],ct=["onClick"],ut=["onClick"],xt={class:"flex items-center mb-4"},mt={class:"text-gray-700 mb-6 text-sm tracking-wide"},gt={class:"flex space-x-3"},pt={__name:"FlowsView",setup(p){const _=xe();fe();const{flows:v,loading:C,getFlows:m,deleteFlow:y,cloneFlow:D,executeFlow:w,getFlowInputs:c}=be(),a=h(!1),o=h(null),b=h(""),N=h(new Set),$=h(null),I=h(!1),L=h(null),M=h([]),j=h(!1),q=re(()=>b.value.trim()?v.value.filter(s=>{var e,g,x;return s.name.toLowerCase().includes(b.value.toLowerCase())||((e=s.description)==null?void 0:e.toLowerCase().includes(b.value.toLowerCase()))||((g=s.category)==null?void 0:g.toLowerCase().includes(b.value.toLowerCase()))||((x=s.tags)==null?void 0:x.some(l=>l.toLowerCase().includes(b.value.toLowerCase())))}):v.value);de(()=>F(null,null,function*(){yield m({page:1,limit:100})}));function P(){_.push("/flows/create")}function K(s){const e=s.id||s._id;if(!e){alert("Error: Flow ID is missing.");return}_.push(`/flows/${e}/edit`)}function X(s){return F(this,null,function*(){const e=s._id||s.id;(yield D(e)).success&&(yield m({page:1,limit:100}))})}function Y(s){o.value=s,a.value=!0}function Z(){return F(this,null,function*(){if(!o.value)return;const s=o.value._id||o.value.id;(yield y(s)).success&&(a.value=!1,o.value=null,yield m({page:1,limit:100}))})}function ee(s){const e=localStorage.getItem("accessToken"),g=s._id||s.id;if(!e)return;const x=`/editor/?flowId=${g}`;window.open(x,"_blank")}function te(s){return F(this,null,function*(){var l;const e=s._id||s.id,g=yield c(e);if(!g.success){alert(`Erro ao buscar inputs: ${g.error}`);return}const x=((l=g.data.data)==null?void 0:l.inputs)||[];x.length>0?(L.value=s,M.value=x,I.value=!0):yield O(e)})}function O(g){return F(this,arguments,function*(s,e={}){N.value.add(s),j.value=!0;const x=yield w(s,e);N.value.delete(s),j.value=!1,x.success?(I.value=!1,alert("Flow executado com sucesso!"),yield m({page:1,limit:100})):alert(`Erro ao executar flow: ${x.error}`)})}function se(s){var g,x;const e=((g=L.value)==null?void 0:g._id)||((x=L.value)==null?void 0:x.id);e&&O(e,s)}function oe(){j.value||(I.value=!1,L.value=null,M.value=[])}function S(s){const e=s._id||s.id;return N.value.has(e)}function le(s){return new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function ae(s,e){e.stopPropagation(),$.value=$.value===s?null:s}function T(){$.value=null}function R(s){const e=s._id||s.id;return $.value===e}function B(){$.value=null}return Q($,s=>{s?ge(()=>{document.addEventListener("click",B)}):document.removeEventListener("click",B)}),ce(()=>{document.removeEventListener("click",B)}),(s,e)=>(d(),H(pe,null,{default:ue(()=>{var g,x;return[t("div",Ae,[t("div",Pe,[e[7]||(e[7]=t("div",null,[t("h1",{class:"text-3xl font-semibold text-gray-800 tracking-wide"},"Fluxos"),t("p",{class:"text-gray-600 mt-2 text-sm tracking-wide"},"Crie e gerencie seus fluxos de automação")],-1)),t("button",{onClick:P,class:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-5 py-2.5 rounded-lg flex items-center space-x-2 transition-all shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 text-sm font-medium tracking-wide"},[i(n(r),{icon:"lucide:plus",class:"w-4 h-4"}),e[6]||(e[6]=t("span",null,"Criar Novo Fluxo",-1))])])]),t("div",Oe,[t("div",Re,[t("div",Ge,[i(n(r),{icon:"lucide:search",class:"w-5 h-5 text-gray-400"})]),U(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>b.value=l),type:"text",placeholder:"Buscar fluxos por nome, descrição, categoria ou tags...",class:"block w-full pl-10 pr-3 py-2.5 bg-white/50 backdrop-blur-sm border border-gray-300 rounded-lg text-gray-900 placeholder-gray-400 focus:outline-none focus:border-blue-500 focus:bg-white/70 transition-all text-sm tracking-wide"},null,512),[[me,b.value]])])]),n(C)?(d(),u("div",He,[i(n(r),{icon:"lucide:loader-2",class:"w-8 h-8 animate-spin text-blue-600"})])):q.value.length===0&&!b.value.trim()?(d(),u("div",Qe,[i(n(r),{icon:"lucide:workflow",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[9]||(e[9]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum fluxo encontrado",-1)),e[10]||(e[10]=t("p",{class:"text-gray-600 mb-6 text-sm tracking-wide"}," Crie seu primeiro fluxo para começar ",-1)),t("button",{onClick:P,class:"bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-5 py-2.5 rounded-lg transition-all inline-flex items-center space-x-2 shadow-lg shadow-blue-500/30 hover:shadow-xl hover:shadow-blue-500/40 text-sm font-medium tracking-wide"},[i(n(r),{icon:"lucide:plus",class:"w-4 h-4"}),e[8]||(e[8]=t("span",null,"Criar Primeiro Fluxo",-1))])])):q.value.length===0&&b.value.trim()?(d(),u("div",We,[i(n(r),{icon:"lucide:search",class:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e[11]||(e[11]=t("h3",{class:"text-lg font-semibold text-gray-800 mb-2"},"Nenhum fluxo encontrado",-1)),e[12]||(e[12]=t("p",{class:"text-gray-600 mb-6 text-sm tracking-wide"}," Nenhum fluxo corresponde aos seus critérios de busca. Tente ajustar os termos. ",-1)),t("button",{onClick:e[1]||(e[1]=l=>b.value=""),class:"text-blue-600 hover:text-blue-700 text-sm font-medium transition-colors underline decoration-blue-600/30 hover:decoration-blue-600/60 underline-offset-2"}," Limpar busca ")])):(d(),u("div",Je,[(d(!0),u(W,null,J(q.value,l=>{var G;return d(),u("div",{key:l._id||l.id,class:z(["glass-card backdrop-blur-xl bg-white/70 rounded-2xl border border-white/40 shadow-sm hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group relative",{"z-50":R(l)}])},[e[19]||(e[19]=t("div",{class:"absolute inset-0 bg-gradient-to-br from-blue-500/0 to-cyan-500/0 group-hover:from-blue-500/5 group-hover:to-cyan-500/5 transition-all duration-300 pointer-events-none rounded-2xl overflow-hidden"},null,-1)),t("div",Ke,[t("div",Xe,[t("h3",Ye,f(l.name),1),l.isPublic?(d(),H(n(r),{key:0,icon:"lucide:globe",class:"w-4 h-4 text-green-600 flex-shrink-0 mt-0.5",title:"Fluxo público"})):k("",!0)]),t("p",Ze,f(l.description||"Sem descrição disponível"),1),t("div",et,[t("span",tt,[i(n(r),{icon:"lucide:git-branch",class:"w-3.5 h-3.5 text-blue-500"}),V(" "+f(l.totalNodes||0)+" nós ",1)]),t("span",st,[i(n(r),{icon:"lucide:play",class:"w-3.5 h-3.5 text-green-500"}),V(" "+f(((G=l.executionStats)==null?void 0:G.totalExecutions)||0),1)])]),t("div",ot,[i(n(r),{icon:"lucide:clock",class:"w-3.5 h-3.5"}),V(" "+f(le(l.updatedAt||l.createdAt)),1)]),t("div",lt,[t("button",{onClick:E=>te(l),disabled:S(l),class:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-green-500/10 text-green-700 hover:bg-green-500/20 rounded-lg transition-all text-xs font-medium disabled:opacity-50 disabled:cursor-not-allowed",title:"Executar Fluxo"},[i(n(r),{icon:S(l)?"lucide:loader-2":"lucide:play",class:z(["w-3.5 h-3.5",{"animate-spin":S(l)}])},null,8,["icon","class"]),e[13]||(e[13]=t("span",null,"Executar",-1))],8,at),t("button",{onClick:E=>ee(l),class:"flex-1 flex items-center justify-center gap-1.5 px-3 py-2 bg-blue-500/10 text-blue-700 hover:bg-blue-500/20 rounded-lg transition-all text-xs font-medium",title:"Abrir Editor"},[i(n(r),{icon:"lucide:square-pen",class:"w-3.5 h-3.5"}),e[14]||(e[14]=t("span",null,"Editor",-1))],8,nt),t("div",it,[t("button",{onClick:E=>ae(l._id||l.id,E),class:"p-2 text-gray-600 hover:bg-gray-500/10 rounded-lg transition-all",title:"Mais opções"},[i(n(r),{icon:"lucide:more-vertical",class:"w-4 h-4"})],8,rt),R(l)?(d(),u("div",{key:0,onClick:e[2]||(e[2]=A(()=>{},["stop"])),class:"absolute right-0 top-full mt-1 w-40 backdrop-blur-xl bg-white/90 rounded-xl shadow-xl border border-white/40 py-1 z-50 overflow-hidden"},[t("button",{onClick:E=>{K(l),T()},class:"w-full flex items-center gap-2 px-3 py-2 text-blue-600 hover:bg-blue-500/10 transition-all text-xs"},[i(n(r),{icon:"lucide:settings",class:"w-3.5 h-3.5"}),e[15]||(e[15]=t("span",null,"Editar",-1))],8,dt),t("button",{onClick:E=>{X(l),T()},class:"w-full flex items-center gap-2 px-3 py-2 text-cyan-600 hover:bg-cyan-500/10 transition-all text-xs"},[i(n(r),{icon:"lucide:copy",class:"w-3.5 h-3.5"}),e[16]||(e[16]=t("span",null,"Duplicar",-1))],8,ct),e[18]||(e[18]=t("div",{class:"border-t border-gray-200/50 my-1"},null,-1)),t("button",{onClick:E=>{Y(l),T()},class:"w-full flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-500/10 transition-all text-xs"},[i(n(r),{icon:"lucide:trash-2",class:"w-3.5 h-3.5"}),e[17]||(e[17]=t("span",null,"Excluir",-1))],8,ut)])):k("",!0)])])])],2)}),128))])),i(ze,{show:I.value,"flow-name":((g=L.value)==null?void 0:g.name)||"",inputs:M.value,loading:j.value,onClose:oe,onExecute:se},null,8,["show","flow-name","inputs","loading"]),a.value?(d(),u("div",{key:4,class:"fixed inset-0 bg-gray-900/50 backdrop-blur-sm flex items-center justify-center z-50",onClick:e[5]||(e[5]=l=>a.value=!1)},[t("div",{class:"glass-card backdrop-blur-xl bg-white/70 rounded-lg border border-white/40 p-6 max-w-sm w-full mx-4 shadow-xl",onClick:e[4]||(e[4]=A(()=>{},["stop"]))},[t("div",xt,[i(n(r),{icon:"lucide:alert-triangle",class:"w-6 h-6 text-red-600 mr-3"}),e[20]||(e[20]=t("h3",{class:"text-lg font-semibold text-gray-900 tracking-wide"},"Excluir Fluxo",-1))]),t("p",mt,' Tem certeza que deseja excluir "'+f((x=o.value)==null?void 0:x.name)+'"? Esta ação não pode ser desfeita. ',1),t("div",gt,[t("button",{onClick:e[3]||(e[3]=l=>a.value=!1),class:"flex-1 px-4 py-2.5 bg-white/70 backdrop-blur-sm border border-gray-300 text-gray-700 rounded-lg hover:bg-white/90 hover:brightness-95 transition-all text-sm font-medium tracking-wide"}," Cancelar "),t("button",{onClick:Z,class:"flex-1 px-4 py-2.5 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-all text-sm font-medium tracking-wide shadow-lg shadow-red-500/30"}," Excluir ")])])])):k("",!0)]}),_:1}))}},_t=ve(pt,[["__scopeId","data-v-91215cf0"]]);export{_t as default};
