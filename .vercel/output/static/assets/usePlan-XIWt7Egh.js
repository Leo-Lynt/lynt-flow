var i=(h,v,m)=>new Promise((P,y)=>{var b=c=>{try{r(m.next(c))}catch(w){y(w)}},o=c=>{try{r(m.throw(c))}catch(w){y(w)}},r=c=>c.done?P(c.value):Promise.resolve(c.value).then(b,o);r((m=m.apply(h,v)).next())});import{a as p}from"./useAuth-C_Ik1XEG.js";import{r as f,c as u}from"./vue-vendor-BR4PrzJp.js";const E={FREE:{id:"free",name:"FREE",price:0,priceYearly:0,currency:"BRL",limits:{executions:200,flows:5,dataPerMonth:50*1024*1024,dataRetentionDays:7},features:["Editor visual de flows","Conectores básicos (HTTP API, Google Sheets)","Nodes essenciais","Execução manual","Debug viewer","Documentação completa","Suporte via comunidade"],restrictions:["Sem agendamento automático","Sem OAuth connectors","Sem data matching","Sem API access"]},STARTER:{id:"starter",name:"STARTER",price:35.9,priceYearly:290,currency:"BRL",popular:!0,limits:{executions:2e3,flows:25,dataPerMonth:1*1024*1024*1024,dataRetentionDays:30},features:["Tudo do FREE","Agendamento automático (mínimo: 1 hora)","Todos os conectores (OAuth incluído)","Webhooks de entrada","Variáveis e state management","Histórico detalhado","Export/import flows","Notificações por email","Suporte via email (48h)"]},PRO:{id:"pro",name:"PRO",price:130,priceYearly:999,currency:"BRL",limits:{executions:1e4,flows:100,dataPerMonth:10*1024*1024*1024,dataRetentionDays:90},features:["Tudo do STARTER","Agendamento avançado (mínimo: 5 min)","Data matching e deduplicação","REST API completa","Webhooks de saída","Real-time logs via WebSocket","Permissões granulares","Ambientes (dev, staging, prod)","Versionamento de flows","SLA 99.5% uptime","Priority support (4h)","Auditoria completa","Custom nodes (JavaScript)","Integração CI/CD"]}};function J(){const h=f(null),v=f(null),m=f(null),P=f(null),y=f({}),b=f([]),o=f(!1),r=f(""),c=u(()=>{var e;return((e=h.value)==null?void 0:e.planId)||"free"}),w=u(()=>E[c.value.toUpperCase()]||E.FREE),R=u(()=>y.value||{}),T=u(()=>{const e=R.value;return Object.values(e).some(s=>s>=80)}),D=u(()=>{const e=R.value;return Object.values(e).some(s=>s>=100)}),M=u(()=>{var e,s;return((e=v.value)==null?void 0:e.currentPeriodEnd)||((s=v.value)==null?void 0:s.nextPaymentDate)||null});function g(){return i(this,null,function*(){var e,s,t;try{o.value=!0,r.value="";const a=yield p.get("/auth/profile");if((e=a.data)!=null&&e.success){const n=a.data.data;return h.value=n.currentPlan||{planId:"free",isPaid:!1},m.value=n.usage||{executions:0,activeFlows:0,dataUsed:0},P.value=n.limits||E.FREE.limits,y.value=n.usagePercentages||{},b.value=n.warnings||[],{success:!0,data:n}}return{success:!1,error:"Failed to fetch plan"}}catch(a){return r.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Erro ao buscar plano",{success:!1,error:r.value}}finally{o.value=!1}})}function x(){return i(this,null,function*(){return g()})}function L(){return i(this,null,function*(){var e,s,t;try{o.value=!0,r.value="";const a=yield p.get("/billing/subscription");return(e=a.data)!=null&&e.success?(v.value=a.data.subscription,{success:!0,data:a.data.subscription}):{success:!1,error:"Failed to fetch subscription"}}catch(a){return r.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Erro ao buscar assinatura",{success:!1,error:r.value}}finally{o.value=!1}})}function N(e,s="monthly"){return i(this,null,function*(){var t,a,n,d,S,A,F,k;try{o.value=!0,r.value="",console.log("[usePlan] Creating checkout session:",{planId:e,billingInterval:s});const l=yield p.post("/billing/checkout",{planId:e,billingInterval:s});if(console.log("[usePlan] Checkout response:",l.data),(t=l.data)!=null&&t.success){const C=((a=l.data.data)==null?void 0:a.url)||l.data.url;return console.log("[usePlan] Redirecting to:",C),window.location.href=C,{success:!0}}const B=((n=l.data)==null?void 0:n.message)||"Failed to create checkout session";return console.error("[usePlan] Checkout failed:",B),{success:!1,error:B}}catch(l){return console.error("[usePlan] Checkout error:",l),console.error("[usePlan] Error response:",(d=l.response)==null?void 0:d.data),r.value=((A=(S=l.response)==null?void 0:S.data)==null?void 0:A.message)||((k=(F=l.response)==null?void 0:F.data)==null?void 0:k.error)||"Erro ao criar sessão de checkout",{success:!1,error:r.value}}finally{o.value=!1}})}function O(){return i(this,null,function*(){var e,s,t;try{o.value=!0,r.value="";const a=yield p.post("/billing/portal");return(e=a.data)!=null&&e.success?(window.location.href=a.data.data.url,{success:!0}):{success:!1,error:"Failed to open billing portal"}}catch(a){return r.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Erro ao abrir portal de cobrança",{success:!1,error:r.value}}finally{o.value=!1}})}function I(e,s="monthly"){return i(this,null,function*(){var t,a,n;try{return o.value=!0,r.value="",(t=(yield p.post("/billing/upgrade",{newPlanId:e,newBillingInterval:s})).data)!=null&&t.success?(yield g(),{success:!0,message:"Plano atualizado com sucesso!"}):{success:!1,error:"Failed to upgrade plan"}}catch(d){return r.value=((n=(a=d.response)==null?void 0:a.data)==null?void 0:n.message)||"Erro ao fazer upgrade do plano",{success:!1,error:r.value}}finally{o.value=!1}})}function z(e,s="monthly"){return i(this,null,function*(){var t,a,n;try{return o.value=!0,r.value="",(t=(yield p.post("/billing/downgrade",{newPlanId:e,newBillingInterval:s})).data)!=null&&t.success?(yield g(),{success:!0,message:"Downgrade agendado para o fim do período atual"}):{success:!1,error:"Failed to downgrade plan"}}catch(d){return r.value=((n=(a=d.response)==null?void 0:a.data)==null?void 0:n.message)||"Erro ao fazer downgrade do plano",{success:!1,error:r.value}}finally{o.value=!1}})}function U(){return i(this,null,function*(){var e,s,t;try{return o.value=!0,r.value="",(e=(yield p.post("/billing/cancel")).data)!=null&&e.success?(yield g(),{success:!0,message:"Assinatura cancelada com sucesso"}):{success:!1,error:"Failed to cancel subscription"}}catch(a){return r.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Erro ao cancelar assinatura",{success:!1,error:r.value}}finally{o.value=!1}})}function W(){return i(this,null,function*(){var e,s,t;try{return o.value=!0,r.value="",(e=(yield p.post("/billing/reactivate")).data)!=null&&e.success?(yield g(),{success:!0,message:"Assinatura reativada com sucesso!"}):{success:!1,error:"Failed to reactivate subscription"}}catch(a){return r.value=((t=(s=a.response)==null?void 0:s.data)==null?void 0:t.message)||"Erro ao reativar assinatura",{success:!1,error:r.value}}finally{o.value=!1}})}function Y(e){if(e===0)return"0 Bytes";const s=1024,t=["Bytes","KB","MB","GB"],a=Math.floor(Math.log(e)/Math.log(s));return Math.round(e/Math.pow(s,a)*100)/100+" "+t[a]}function j(e){return new Intl.NumberFormat("pt-BR").format(e)}return{currentPlan:u(()=>h.value),subscription:u(()=>v.value),usage:u(()=>m.value),limits:u(()=>P.value),warnings:u(()=>b.value),loading:u(()=>o.value),error:u(()=>r.value),planName:c,planDetails:w,usagePercentages:R,isNearLimit:T,isOverLimit:D,nextBillingDate:M,PLANS:E,getCurrentPlan:g,getCurrentUsage:x,getSubscription:L,createCheckoutSession:N,openBillingPortal:O,upgradePlan:I,downgradePlan:z,cancelSubscription:U,reactivateSubscription:W,formatBytes:Y,formatNumber:j}}export{J as u};
