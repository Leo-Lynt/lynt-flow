import{u as N}from"./dataUtils-XrCV_Bny.js";import{g as m}from"./pathUtils-v1uP8zBE.js";import"./index-aSFpVsIL.js";function b(t,s="iso"){if(!t)return null;try{switch(s){case"iso":case"iso-datetime":const l=new Date(t);return isNaN(l.getTime())?null:l;case"br":if(typeof t!="string")return null;const u=t.split("/");if(u.length!==3)return null;const[c,r,e]=u,o=new Date(`${e}-${r.padStart(2,"0")}-${c.padStart(2,"0")}`);return isNaN(o.getTime())?null:o;case"us":if(typeof t!="string")return null;const n=t.split("/");if(n.length!==3)return null;const[f,d,i]=n,a=new Date(`${i}-${f.padStart(2,"0")}-${d.padStart(2,"0")}`);return isNaN(a.getTime())?null:a;case"timestamp":const g=Number(t);if(isNaN(g))return null;const p=new Date(g);return isNaN(p.getTime())?null:p;default:const h=new Date(t);return isNaN(h.getTime())?null:h}}catch{return null}}function y(t,s,l,u="auto",c="iso"){let r=t,e=s;if(u==="date"){const o=b(t,c),n=b(s,c);if(!o||!n)return!1;r=o.getTime(),e=n.getTime()}else if(u==="number"){if(r=Number(t),e=Number(s),isNaN(r)||isNaN(e))return!1}else if(u==="boolean"){const o=n=>{if(typeof n=="boolean")return n;if(typeof n=="number")return n!==0;if(typeof n=="string"){const f=n.toLowerCase();return f==="true"||f==="yes"||f==="1"}return!!n};r=o(t),e=o(s)}else if(u==="string")r=String(t),e=String(s);else if(u==="auto"){const o=Number(t),n=Number(s);!isNaN(o)&&!isNaN(n)?(r=o,e=n):(r=String(t),e=String(s))}switch(l){case"equals":return r===e;case"notEquals":return r!==e;case"greaterThan":return r>e;case"lessThan":return r<e;case"greaterOrEqual":return r>=e;case"lessOrEqual":return r<=e;case"contains":return String(r).toLowerCase().includes(String(e).toLowerCase());case"startsWith":return String(r).toLowerCase().startsWith(String(e).toLowerCase());case"endsWith":return String(r).toLowerCase().endsWith(String(e).toLowerCase());default:return!0}}function q({nodeData:t,inputs:s}){var d;let l=N(s["data-input"]);if(!Array.isArray(l))throw new Error("Input deve ser um array");const u=t.fieldMode||"selector";let c;if(u==="custom")c=t.customField;else{const i=t.selectedField;Array.isArray(i)&&i.length>0?c=i[0]:typeof i=="string"&&(c=i)}const r=t.operator||"equals";let e=s["exposed-value"]!==void 0?N(s["exposed-value"]):t.value;if((d=t.exposedFields)!=null&&d.value&&typeof e=="object"&&e!==null&&!Array.isArray(e))if("value"in e)e=e.value;else if(r==="greaterThan"||r==="greaterOrEqual")e=e.StartData||e.start||e.from||Object.values(e)[0];else if(r==="lessThan"||r==="lessOrEqual")e=e.EndData||e.end||e.to||Object.values(e)[1]||Object.values(e)[0];else{const i=Object.values(e);i.length>0&&(e=i[0])}const o=t.comparisonType||"auto",n=t.dateFormat||"iso";return r==="exists"?l.filter(i=>{const a=m(i,c);return a!=null}):r==="notExists"?l.filter(i=>{const a=m(i,c);return a==null}):l.filter(i=>{const a=m(i,c);return a==null?!1:y(a,e,r,o,n)})}function v(t){const s=[];return(t.fieldMode||"selector")==="custom"?t.customField||s.push("Campo customField obrigatório no modo custom"):(!t.selectedField||Array.isArray(t.selectedField)&&t.selectedField.length===0)&&s.push("Seleção de campo obrigatória"),t.operator||s.push('Campo "operator" obrigatório'),["equals","notEquals","greaterThan","lessThan","greaterOrEqual","lessOrEqual","contains","startsWith","endsWith"].includes(t.operator)&&!t.value&&s.push(`Operador "${t.operator}" requer um valor de comparação`),{valid:s.length===0,errors:s}}export{q as execute,v as validate};
