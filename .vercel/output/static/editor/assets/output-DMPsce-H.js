import{u as f}from"./dataUtils-XrCV_Bny.js";import"./index-B489Xgm1.js";async function w(n,a,i){const{type:e,config:o}=a;if(e==="display")return n;if(e==="apiResponse")return{_isApiResponse:!0,data:n,config:o};const t={webhook:"/api/output/webhook",email:"/api/output/email",googleSheets:"/api/output/google-sheets",download:"/api/output/download"}[e];if(!t)throw new Error(`Unknown destination type: ${e}`);const s=i.baseUrl,u=i.token;if(!u)throw new Error("Missing authentication token for output operation");try{const r=await fetch(`${s}${t}`,{method:"POST",headers:{Authorization:`Bearer ${u}`,"Content-Type":"application/json"},body:JSON.stringify({data:n,config:o})});if(!r.ok){const l=await r.json().catch(()=>({message:"Output request failed"}));throw new Error(l.message||`Output failed with status ${r.status}`)}if(e==="download"){const l=await r.blob(),p=URL.createObjectURL(l),c=document.createElement("a");c.href=p;const y=o.filename||"output",h=o.format==="csv"?"csv":o.format==="excel"?"xlsx":"json";return c.download=`${y}.${h}`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(p),{success:!0,message:"File downloaded successfully"}}return await r.json()}catch(r){throw r}}async function k({nodeData:n,inputs:a,context:i}){const e={};n.dynamicInputs&&n.dynamicInputs.length>0?n.dynamicInputs.forEach(t=>{const s=t.key,u=`data-${s}`,r=a[u]!==void 0?a[u]:a[s];r!==void 0&&(e[s]=f(r))}):Object.keys(a).forEach(t=>{const s=t.startsWith("data-")?t.substring(5):t;e[s]=f(a[t])});const o=n.destination||"display",d=n.destinationConfig||{};if(o==="display")return e;try{const t=(i==null?void 0:i.apiConfig)||{};if(!t.token)return console.warn("‚ö†Ô∏è Output: No authentication token found. Cannot send to destination:",o),{success:!1,error:"Authentication required",data:e};console.log(`üì§ Output: Sending to ${o}`,{config:d,dataKeys:Object.keys(e)});const s=await w(e,{type:o,config:d},t);return console.log(`‚úÖ Output: Successfully sent to ${o}`,s),{success:!0,destination:o,result:s,data:e}}catch(t){return console.error(`‚ùå Output: Error sending to ${o}:`,t),{success:!1,destination:o,error:t.message,data:e}}}function O(n){return{valid:!0,errors:[]}}export{k as execute,O as validate};
